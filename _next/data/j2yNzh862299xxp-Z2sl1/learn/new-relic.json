{"pageProps":{"post":{"title":"new relic","slug":"new-relic","content":"<h1>Browser Application</h1>\n<ul>\n<li>You can create a New Relic <code>Browser Application</code> in the online GUI or you can do so via REST service</li>\n</ul>\n<h2>Manually add New Relic Browser Monitoring</h2>\n<ul>\n<li>View the documentation <a href=\"https://docs.newrelic.com/docs/browser/browser-monitoring/installation/install-browser-monitoring-agent/\">here</a></li>\n<li>Steps:\n<ol>\n<li>Go to one.newrelic.com, select Browser, and then select <code>Add more data</code> button.</li>\n<li>Under the <code>Browser metrics</code> section click the <code>New Relic Browser</code> button.</li>\n<li>Select the account &#x26; continue</li>\n<li>Make sure you select the <code>Copy/Paste Javascript code</code> radio button</li>\n<li>For step #3 select <code>No. (Name your standalone app)</code> and give you application a name</li>\n<li>Generate some traffic for your app, then wait a few minutes for data to appear in New Relic.</li>\n<li>Optional: After installation is complete and you are seeing data, go to the App settings page for additional agent configuration, or to change the browser agent type.</li>\n</ol>\n</li>\n</ul>\n<h2>Browser Application - via REST service</h2>\n<ul>\n<li><strong>When you add a browser app via API (v2), you can only instrument basic page load timing. To use instrumentation supporting all SPA features, <a href=\"https://docs.newrelic.com/docs/browser/single-page-app-monitoring/get-started/install-single-page-app-monitoring/\">set up single page app monitoring via another method.</a></strong></li>\n<li>So basically DON'T create a new New Relic Browser Monitoring app via the REST service</li>\n<li>View the documentation <a href=\"https://docs.newrelic.com/docs/apis/rest-api-v2/browser-examples-v2/add-or-list-browser-apps-api-v2/\">here</a></li>\n<li>Create an API key by clicking on your avatar in the navbar > <code>API Keys</code> > <code>Create a Key</code></li>\n<li>Create a new  <code>Browser Application</code>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -X POST <span class=\"token string\">'https://api.newrelic.com/v2/browser_applications.json'</span> <span class=\"token punctuation\">\\</span>\n     -H <span class=\"token string\">\"X-Api-Key:<span class=\"token variable\">${APIKEY}</span>\"</span> -i <span class=\"token punctuation\">\\</span>\n     -H <span class=\"token string\">'Content-Type: application/json'</span> <span class=\"token punctuation\">\\</span>\n     -d <span class=\"token punctuation\">\\</span>\n<span class=\"token string\">'{\n  \"browser_application\": {\n    \"name\": <span class=\"token variable\">${STRING}</span>\n  }\n}'</span>\n</code></pre></div>\n</li>\n<li>List all current browser applications\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -X GET <span class=\"token string\">'https://api.newrelic.com/v2/browser_applications.json'</span> <span class=\"token punctuation\">\\</span>\n     -H <span class=\"token string\">\"X-Api-Key:<span class=\"token variable\">${APIKEY}</span>\"</span> -i\n</code></pre></div>\n</li>\n<li>View a specific browser app\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -X GET <span class=\"token string\">'https://api.newrelic.com/v2/browser_applications.json'</span> <span class=\"token punctuation\">\\</span>\n     -H <span class=\"token string\">\"X-Api-Key:<span class=\"token variable\">${APIKEY}</span>\"</span> -i <span class=\"token punctuation\">\\</span>\n     -d <span class=\"token string\">\"filter[name]=<span class=\"token variable\">${NAME}</span>\"</span>\n</code></pre></div>\n</li>\n<li>The REST service list each application's <code>id</code>, <code>name</code>, <code>browser_monitoring_key</code>, &#x26; <code>loader_script</code></li>\n<li>The <code>loader_script</code> is the script tag you need to add to your project</li>\n</ul>\n<h1>Alert Policies</h1>\n<ul>\n<li>\n<p>In New Relic <em>Alert Policy</em> is basically a folder containing multiple <em>contidions</em></p>\n</li>\n<li>\n<p>The condition is basically <em>what</em> to monitor, <em>when</em> a condidtion is met, &#x26; <em>who</em> to notify</p>\n</li>\n<li>\n<p>After creating 1/more conditions if one of those conditions are hit it will generate a violation, which will then create incidents</p>\n</li>\n<li>\n<p>Incidents lifecycle: <em>open</em>, <em>acknowledged</em>, &#x26; <em>close</em></p>\n</li>\n<li>\n<p>Creating NR Alerts and conditions manually:</p>\n<ol>\n<li>Create a <code>Alert Policy</code> aka <em>Alert Folder</em>:</li>\n</ol>\n<ul>\n<li>Select the <code>tech-prd</code> account</li>\n<li><code>Alerts &#x26; AI</code> > <code>Alert conditions (Policies)</code> > <code>+ New alert policy</code></li>\n<li>Create alert policy</li>\n<li>Alert policy name</li>\n<li>Incident preference <code>By policy</code>, <code>By condition</code>, <code>By condition and signal</code></li>\n</ul>\n<ol start=\"2\">\n<li>Add condition(s)</li>\n</ol>\n<ul>\n<li>Click the <code>Create a condition</code></li>\n<li>Select a category: <code>Browser</code> > <code>Metric</code></li>\n<li>Select an entity(s): <code>nike-cx/**</code></li>\n<li>Select a threshold:\n<ul>\n<li><code>Apdex score</code> or <code>Page views with JS errors</code></li>\n<li><code>10</code>% for at least <code>5</code> minutes</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Create <em>Alert Policy</em> &#x26; <em>Condition</em> with terraform:</p>\n<div class=\"remark-highlight\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">terraform</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">backend<span class=\"token type variable\"> \"s3\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">key</span>    <span class=\"token punctuation\">=</span> <span class=\"token string\">\"my-nr-alerts\"</span>\n    <span class=\"token property\">region</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"us-west-2\"</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token property\">required_version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\">= 0.13.5\"</span>\n  <span class=\"token keyword\">required_providers</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">aws</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">source</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"hashicorp/aws\"</span>\n      <span class=\"token property\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"~>4.2.0\"</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token property\">newrelic</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">source</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"newrelic/newrelic\"</span>\n      <span class=\"token property\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"~> 2.37.0\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">provider<span class=\"token type variable\"> \"newrelic\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">account_id</span> <span class=\"token punctuation\">=</span> var.NR_ACCOUNT_ID\n  <span class=\"token property\">api_key</span>    <span class=\"token punctuation\">=</span> var.NR_API_KEY_PROD\n  <span class=\"token property\">region</span>     <span class=\"token punctuation\">=</span> <span class=\"token string\">\"US\"</span> <span class=\"token comment\"># Valid regions are US and EU</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">##################################################</span>\n<span class=\"token comment\"># Create Alert Policy &#x26; Condition</span>\n<span class=\"token comment\">##################################################</span>\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"newrelic_alert_policy\"</span></span> <span class=\"token string\">\"alert_policy\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"My Web App - Browser Policy\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"newrelic_nrql_alert_condition\"</span></span> <span class=\"token string\">\"spike_of_10x\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">policy_id</span> <span class=\"token punctuation\">=</span> newrelic_alert_policy.alert_policy.id\n  <span class=\"token property\">enabled</span>   <span class=\"token punctuation\">=</span> var.enable_alerts\n\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token comment\"># Section: Enter condition name</span>\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"10x error\"</span>\n\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token comment\"># Section: Define your signal</span>\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token keyword\">nrql</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">query</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"SELECT count(*) FROM JavaScriptError FACET errorClass WHERE appName = '<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">nr_browser_monitor_app_name</span><span class=\"token punctuation\">}</span></span>'\"</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token property\">fill_value</span>  <span class=\"token punctuation\">=</span> <span class=\"token number\">1.0</span>\n  <span class=\"token property\">fill_option</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"static\"</span> <span class=\"token comment\"># Strategy to use when filling gaps in the signal.</span>\n\n\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token comment\"># Section: `Set your condition thresholds`</span>\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token property\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"static\"</span> <span class=\"token comment\"># [static, baseline, outlier]</span>\n  <span class=\"token property\">value_function</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"sum\"</span> <span class=\"token comment\"># [single_value, sum] # `Open violation when the`  sum == `sum of query result is`</span>\n  <span class=\"token property\">aggregation_delay</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">120</span>\n  <span class=\"token comment\"># expiration_duration            = 120    #  `Signal is lost after` </span>\n  <span class=\"token comment\"># close_violations_on_expiration = true   # `Close all current open violations`</span>\n  <span class=\"token comment\"># open_violation_on_expiration   = true   # `Open new \"lost signal\" violation`</span>\n\n  <span class=\"token keyword\">critical</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">operator</span>              <span class=\"token punctuation\">=</span> <span class=\"token string\">\"above\"</span>\n    <span class=\"token property\">threshold</span>             <span class=\"token punctuation\">=</span> <span class=\"token number\">10</span>\n    <span class=\"token property\">threshold_duration</span>    <span class=\"token punctuation\">=</span> <span class=\"token number\">300</span> <span class=\"token comment\"># 5 minutes</span>\n    <span class=\"token property\">threshold_occurrences</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"at_least_once\"</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\"># warning {</span>\n  <span class=\"token comment\">#   operator              = \"above\"</span>\n  <span class=\"token comment\">#   threshold             = 10</span>\n  <span class=\"token comment\">#   threshold_duration    = 600</span>\n  <span class=\"token comment\">#   threshold_occurrences = \"ALL\"</span>\n  <span class=\"token comment\"># }</span>\n\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token comment\"># Fine-tune advanced signal settings</span>\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token property\">aggregation_method</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"event_flow\"</span> <span class=\"token comment\"># `Streaming method` [cadence, event_flow, event_timer]</span>\n\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token comment\"># Section: Additional settings</span>\n  <span class=\"token comment\">##################################################</span>\n  <span class=\"token property\">violation_time_limit_seconds</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">259200</span> <span class=\"token comment\"># (3 days) `Close open violations after:` automatically force-close a long-lasting violation</span>\n  <span class=\"token property\">description</span>                  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Alert when there is a 10x the account of JS errors for our client-side application\"</span> <span class=\"token comment\"># `Send a custom violation description`</span>\n  <span class=\"token property\">runbook_url</span>                  <span class=\"token punctuation\">=</span> var.runbook_url\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">#########################</span>\n<span class=\"token comment\"># Send out alerts</span>\n<span class=\"token comment\">#########################</span>\n<span class=\"token comment\"># Creates an email alert channel.</span>\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"newrelic_alert_channel\"</span></span> <span class=\"token string\">\"email_channel\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"CX - <span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">project_name</span><span class=\"token punctuation\">}</span></span> - Browser Alert\"</span>\n  <span class=\"token property\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"email\"</span>\n  <span class=\"token keyword\">config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">recipients</span>              <span class=\"token punctuation\">=</span> <span class=\"token string\">\"phil.willis@nike.com\"</span>\n    <span class=\"token property\">include_json_attachment</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Creates a Slack alert channel.</span>\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"newrelic_alert_channel\"</span></span> <span class=\"token string\">\"slack_channel\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"slack-channel-example\"</span>\n  <span class=\"token property\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"slack\"</span>\n  <span class=\"token keyword\">config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">channel</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"#example-channel\"</span>\n    <span class=\"token property\">url</span>     <span class=\"token punctuation\">=</span> <span class=\"token string\">\"http://example-org.slack.com\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Applies the created channels above to the alert policy</span>\n<span class=\"token comment\"># referenced at the top of the config.</span>\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"newrelic_alert_policy_channel\"</span></span> <span class=\"token string\">\"foo\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">policy_id</span>  <span class=\"token punctuation\">=</span> newrelic_alert_policy.alert_policy.id\n  <span class=\"token property\">channel_ids</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n    newrelic_alert_channel.email_channel.id,\n    newrelic_alert_channel.slack_channel.id\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Make sure you have your AWS creds loaded</span>\n\n<span class=\"token comment\"># New Relic account/api-key</span>\n<span class=\"token assign-left variable\">NR_TECH_PRD_ACCOUNT_ID</span><span class=\"token operator\">=</span><span class=\"token comment\">#####</span>\n<span class=\"token assign-left variable\">NR_TECH_PRD_API_KEY_PROD</span><span class=\"token operator\">=</span><span class=\"token string\">\"NRAK-##########################\"</span> \n\n<span class=\"token comment\"># AWS S3 bucket for TF remote state</span>\n<span class=\"token assign-left variable\">AWS_ACCOUNT_ID</span><span class=\"token operator\">=</span><span class=\"token string\">\"##############\"</span>\n<span class=\"token assign-left variable\">terraform_state_bucket</span><span class=\"token operator\">=</span><span class=\"token string\">\"terraform-remote-config-<span class=\"token variable\">$AWS_ACCOUNT_ID</span>\"</span>\n\n<span class=\"token comment\"># Terraform stuff</span>\n<span class=\"token function\">pushd</span> terraform \n<span class=\"token function\">rm</span> -rf .terraform/\n\n<span class=\"token comment\"># Init terraform with remote state file</span>\nterraform init -backend-config <span class=\"token assign-left variable\">bucket</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${terraform_state_bucket}</span>\"</span>\n\nterraform apply <span class=\"token punctuation\">\\</span>\n  -var<span class=\"token operator\">=</span><span class=\"token string\">\"NR_ACCOUNT_ID=<span class=\"token variable\">$NR_TECH_PRD_ACCOUNT_ID</span>\"</span> <span class=\"token punctuation\">\\</span>\n  -var<span class=\"token operator\">=</span><span class=\"token string\">\"NR_API_KEY_PROD=<span class=\"token variable\">$NR_TECH_PRD_API_KEY_PROD</span>\"</span>\n\n<span class=\"token function\">popd</span>\n</code></pre></div>\n</li>\n</ul>\n","ogImage":{"url":"/assets/covers/newrelic.jpg"},"coverImage":"/assets/covers/newrelic.jpg"}},"__N_SSG":true}