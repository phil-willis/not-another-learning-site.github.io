<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Not another learning site."/><meta property="og:image" content="https://og-image.now.sh/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Not another learning site.</title><meta property="og:image" content="/assets/covers/terraform.jpg"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/4c30c795e0db217f7cd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4c30c795e0db217f7cd8.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6f4272a048091359c753.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6f4272a048091359c753.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-c5113a73163ba9a6512c.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-65342bae310ab86b4830.js" as="script"/><link rel="preload" href="/_next/static/chunks/664-aaadba6b31e09bfd632a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/learn/%5Bslug%5D-696d4f00a359e13ae662.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><div style="position:fixed;background-color:rgba(255,255,255,0.9);backdrop-filter:blur(10px);width:100%;left:0px"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8" style="padding:0;padding-left:10px;margin-bottom:20px"><a class="hover:underline" href="/">Learn</a>.</h2></div><article class="mb-32"><div style="height:100px"></div><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">terraform</h1><div class="mb-8 md:mb-16 sm:mx-0"><div class="sm:mx-0"><img src="/assets/covers/terraform.jpg" alt="Cover Image for terraform" class="shadow-sm" layout="responsive" width="1240" height="620"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div>TODO: add language chip here</div></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><h2>What is Terraform</h2>
<ul>
<li>
<p>Terraform is <code>Infrasture as code</code></p>
</li>
<li>
<p>Other "infrasture-as-code" are: chef, puppet, anisble, SaltStack, CloudFoundation</p>
</li>
<li>
<p>The major building pieces to TF are:</p>
<ul>
<li>variable (variables)</li>
<li>locals (variables with interpellation)</li>
<li>provider (aws|azure|google)</li>
<li>provisioners (execute scripts on a local or remote machine as part of the creation or destruction)</li>
<li>data (get information on existing services)</li>
<li>resource (create resource)</li>
<li>module (isolate configuration)</li>
</ul>
</li>
<li>
<p>Links:</p>
<ul>
<li><a href="https://blog.gruntwork.io/an-introduction-to-terraform-f17df9c6d180">intro</a></li>
<li><a href="https://medium.com/@pavloosadchyi/terraform-patterns-and-tricks-i-use-every-day-117861531173">medium post</a></li>
</ul>
</li>
<li>
<p>Terraform is <code>declarative</code>, it says "I declare therefore i am"</p>
</li>
<li>
<p>non-Terraform services do not get auto-magicly added to your state, Terraform only tracks the things it makes</p>
<ol>
<li>configurations: i declare the intent</li>
<li>State: current state</li>
</ol>
</li>
<li>
<p>dry run <code>$ terraform plan</code></p>
</li>
<li>
<p><strong>NOTE</strong> Terraform ignores subfolders, in order to use subfolders you have to configure the subfolders to be a <code>terraform module</code>, then include those modules in your <code>main.tf</code> file</p>
</li>
</ul>
<h2>Install</h2>
<ul>
<li>You can install TF with homebrew but it's better to install it with <code>tfswitch</code> with homebrew</li>
<li><a href="https://warrensbox.github.io/terraform-switcher/">Terraform version manager</a></li>
<li>this will allow you to switch version very easily
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">$ brew install warrensbox/tap/tfswitch
$ tfswitch 0.12.4
$ terraform -v</code></pre></div>
</li>
</ul>
<h2>Save remote-state in S3</h2>
<ul>
<li>
<p><a href="https://www.terraform.io/docs/backends/types/s3.html">docs</a></p>
</li>
<li>
<p>It is highly recommended that you enable Bucket Versioning on the S3 bucket to allow for state recovery in the case of accidental deletions and human error.</p>
</li>
<li>
<p>Paths to the state file inside the bucket: <em><code>&#x3C;bucket>/&#x3C;workspace_key_prefix>/&#x3C;workspace_name>/&#x3C;key></code></em></p>
<div class="remark-highlight"><pre class="language-html"><code class="language-html">"Amazon S3"/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>BUCKET_NAME_FOR_TF_STATE</span><span class="token punctuation">></span></span>/env:/dev/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>TF_STATE_KEY</span><span class="token punctuation">></span></span>
"Amazon S3"/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>BUCKET_NAME_FOR_TF_STATE</span><span class="token punctuation">></span></span>/env:/staging/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>TF_STATE_KEY</span><span class="token punctuation">></span></span>
"Amazon S3"/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>BUCKET_NAME_FOR_TF_STATE</span><span class="token punctuation">></span></span>/env:/prod/<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>TF_STATE_KEY</span><span class="token punctuation">></span></span>
</code></pre></div>
</li>
<li>
<p>Here is the format for the terraform remote state code block</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">backend<span class="token type variable"> "s3" </span></span><span class="token punctuation">{</span>
    <span class="token property">bucket</span> <span class="token punctuation">=</span> <span class="token string">"mybucket"</span>
    <span class="token property">key</span>    <span class="token punctuation">=</span> <span class="token string">"path/to/my/key"</span>     <span class="token comment"># &#x3C;TF_STATE_KEY>, it can just be a single string</span>
    <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">"us-east-1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Here is an example for the terraform remote state code block</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">backend<span class="token type variable"> "s3" </span></span><span class="token punctuation">{</span>
    <span class="token property">key</span>    <span class="token punctuation">=</span> <span class="token string">"someawesomesite"</span>
    <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">"us-west-2"</span>
  <span class="token punctuation">}</span>
  <span class="token property">required_version</span> <span class="token punctuation">=</span> <span class="token string">">= 0.13.5"</span>
  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
    <span class="token property">aws</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"hashicorp/aws"</span>
      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">"~>3.4"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Key: the path to the state file inside the bucket. When using a non-default workspace, the state path will be /workspace_key_prefix/workspace_name/key</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">data <span class="token type variable">"terraform_remote_state"</span></span> <span class="token string">"network"</span> <span class="token punctuation">{</span>
  <span class="token property">backend</span> <span class="token punctuation">=</span> <span class="token string">"s3"</span>
  <span class="token property">config</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">bucket</span> <span class="token punctuation">=</span> <span class="token string">"terraform-state-prod"</span>
    <span class="token property">key</span>    <span class="token punctuation">=</span> <span class="token string">"network/terraform.tfstate"</span>
    <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">"us-east-1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Or you can have a blank terraform.backend and configure it with bash command</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">state_key</span><span class="token operator">=</span><span class="token string">"prod/some-app/<span class="token variable">${ENVIRONMENT}</span>.tfstate"</span>
terraform init <span class="token punctuation">\</span>
  -backend-config <span class="token assign-left variable">bucket</span><span class="token operator">=</span><span class="token string">"my-terraform-state-bucket"</span> <span class="token punctuation">\</span>
  -backend-config<span class="token operator">=</span><span class="token string">"key=<span class="token variable">${state_key}</span>"</span> <span class="token punctuation">\</span>
  -backend-config<span class="token operator">=</span><span class="token string">"encrypt=true"</span> <span class="token punctuation">\</span>
  -backend-config<span class="token operator">=</span><span class="token string">"region=us-west-2"</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">backend<span class="token type variable"> "s3" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h2>Terraform CLI</h2>
<ul>
<li>
<p><a href="https://www.terraform.io/docs/commands/index.html">Terraform CLI</a></p>
</li>
<li>
<p><code>$ terraform workspace (list|select|new|delete|show)</code></p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ terraform init
$ terraform validate
$ terraform <span class="token function">fmt</span>   <span class="token comment"># format all terraform at the current folder level </span>
$ terraform plan
$ terraform apply
$ terraform apply -auto-approve
$ terraform output
$ terraform workspace

$ terraform <span class="token function">import</span> aws_s3_bucket.bucket <span class="token operator">&#x3C;</span>bucket-name<span class="token operator">></span>
</code></pre></div>
</li>
<li>
<p>The terraform output command is used to extract the value of an output variable from the state file.</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ terraform plan
$ terraform output

$ <span class="token builtin class-name">cd</span> to-base-of-tf-directory
$ terraform output

$ terraform workspace <span class="token keyword">select</span> prod <span class="token operator">&#x26;&#x26;</span> terraform refresh
</code></pre></div>
</li>
</ul>
<h1>Terraform Plugins</h1>
<ul>
<li>Terraform relies on plugins called "providers" to interact with remote systems</li>
<li>Defining your providers:
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
    <span class="token property">mycloud</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"mycorp/mycloud"</span>
      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">"~> 1.0"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>The <code>required_providers</code> block must be nested inside the top-level <code>terraform</code> block (which can also contain other settings).</li>
<li><a href="https://registry.terraform.io/namespaces/hashicorp">main providers</a>
<ul>
<li>Lifecycle management of AWS resources, including EC2, Lambda, EKS, ECS, VPC, S3, RDS, DynamoDB, and more. This provider is maintained internally by the HashiCorp AWS Provider team.</li>
</ul>
</li>
</ul>
<h2>Variable</h2>
<ul>
<li>
<p>You can define variables and provide <code>type</code>, <code>default</code> value, <code>description</code></p>
</li>
<li>
<p>Varaibles have to be hard-coded (you cannot interpolating values)</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "some_variable" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> string
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"hello"</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"This is an example of a variable that has a string type"</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Basic variable types are: string/list/map:</p>
</li>
<li>
<p>The basic structure of defining a variable is:</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "some_key" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>    <span class="token punctuation">=</span> <span class="token string">"&#x3C;string|list|map>"</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"&#x3C;SOME_DEFAULT_VALUE>"</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>All variables used have to be defined beforehand</p>
</li>
<li>
<p>Example of the 3 basic types:</p>
<ul>
<li>String
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> some_string </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> <span class="token string">"string"</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"hello terraform string"</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"this is a simple string"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Use into the resource</span>
<span class="token property">some-parameter</span> <span class="token punctuation">=</span> "$<span class="token punctuation">{</span>var.some_string<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>List
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> some_list </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> <span class="token string">"list"</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">"subnet1"</span>,
    <span class="token string">"subnet2"</span>,
    <span class="token string">"subnet3"</span>,
  <span class="token punctuation">]</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"this is a list"</span>
<span class="token punctuation">}</span>
<span class="token comment"># Use into the resource</span>
<span class="token property">some-parameter</span> <span class="token punctuation">=</span> "$<span class="token punctuation">{</span>var.some_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>Map
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> some_map </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> <span class="token string">"map"</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">subnet1</span> <span class="token punctuation">=</span> <span class="token string">"subnet1"</span>,
    <span class="token property">subnet2</span> <span class="token punctuation">=</span> <span class="token string">"subnet2"</span>,
    <span class="token property">subnet3</span> <span class="token punctuation">=</span> <span class="token string">"subnet3"</span>,
  <span class="token punctuation">}</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"this is a map"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Use into the resource</span>
<span class="token property">some-parameter</span> <span class="token punctuation">=</span> "$<span class="token punctuation">{</span>var.some_map<span class="token punctuation">[</span><span class="token string">"subnet1"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>null</code> value is a special value that has no type</p>
<ul>
<li>a value that represents absence or omission</li>
<li>If you set an argument of a resource or module to null, Terraform behaves as though you had completely omitted it</li>
</ul>
</li>
<li>
<p>When you run terraform all the empty variables (ones without a default value) if not provided in the command will be asked before terraform does it magic.</p>
</li>
<li>
<p>You can also override any variables by passing in them as a flag when you run a terraform command</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ terraform apply -var <span class="token assign-left variable">some_key</span><span class="token operator">=</span><span class="token string">"this rocks"</span>
</code></pre></div>
</li>
<li>
<p>Providing a <code>Variables File</code></p>
<ul>
<li>All <code>*.tfvars</code> will get picked up when you run terraform, sometimes you want to load specific variable files based on the environment you want to deploy so passing supply <code>-var-file=&#x3C;FILE_NAME>.tfvars</code> with variable values might a great way to deal with different variables for different environments</li>
<li><code>tfvar</code> file
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token property">domain_suffix</span> <span class="token punctuation">=</span> <span class="token string">"-dev"</span>
<span class="token property">hosted_zone_name</span> <span class="token punctuation">=</span> <span class="token string">"someawesomesite.com"</span>
<span class="token property">env_tag</span>          <span class="token punctuation">=</span> <span class="token string">"Development"</span>
</code></pre></div>
</li>
<li><code>main.tf</code> file
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> domain_suffix </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">variable<span class="token type variable"> hosted_zone_name </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">variable<span class="token type variable"> env_tag </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div>
</li>
<li><code>Plan</code> script
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment"># `plan.sh` script to run a plan</span>
<span class="token assign-left variable">WORKSPACE</span><span class="token operator">=</span><span class="token string">"dev"</span>
<span class="token assign-left variable">VAR_FILE</span><span class="token operator">=</span><span class="token string">"./env_configs/dev.tfvars"</span>
<span class="token assign-left variable">terraform_state_bucket</span><span class="token operator">=</span><span class="token string">"&#x3C;TERRAFORM_S3_STATE_BUCKET>"</span>
<span class="token function">rm</span> -rf .terraform/
terraform init -backend-config <span class="token assign-left variable">bucket</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${terraform_state_bucket}</span>"</span>
<span class="token keyword">if</span> <span class="token operator">!</span> terraform workspace <span class="token keyword">select</span> <span class="token variable">${WORKSPACE}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  terraform workspace new <span class="token variable">${WORKSPACE}</span>
<span class="token keyword">fi</span>
terraform plan -var-file<span class="token operator">=</span><span class="token variable">$VAR_FILE</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>You can provide variables via the terminal</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">terraform apply -auto-approve <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"SOME_VAR_NAME=SOME_VALUE"</span> <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"SOME_OTHER_VAR_NAME=SOME_VALUE"</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "SOME_VAR_NAME" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> string
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "SOME_OTHER_VAR_NAME" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span> <span class="token punctuation">=</span> string
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h2>Locals (Local Value Configuration)</h2>
<ul>
<li>
<p>locals are like variables that you can pass in ${dynamic} values</p>
</li>
<li>
<p>A local value assigns a name to an expression, so you can use it multiple times within a module without repeating it.</p>
</li>
<li>
<p>DRY principles, allows you to preform logic to create a value where you don't have to write every time</p>
</li>
<li>
<p>You can also reference the a local variable inside the locals code block</p>
</li>
<li>
<p>eg of locals</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">locals</span> <span class="token punctuation">{</span>
  <span class="token property">bucket_name</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">app_namespace</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">terraform</span><span class="token punctuation">.</span><span class="token type variable">workspace</span><span class="token punctuation">}</span></span>-client"</span>
  <span class="token property">domain_name</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">domain_name</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">domain_suffix</span><span class="token punctuation">}</span></span>.<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">hosted_zone_name</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token comment"># Ids for multiple sets of EC2 instances, merged together</span>
<span class="token keyword">locals</span> <span class="token punctuation">{</span>
  <span class="token property">instance_ids</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">concat</span><span class="token punctuation">(</span>aws_instance<span class="token punctuation">.</span>blue<span class="token punctuation">.</span><span class="token punctuation">*</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> aws_instance<span class="token punctuation">.</span>green<span class="token punctuation">.</span><span class="token punctuation">*</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># A computed default name prefix</span>
<span class="token keyword">locals</span> <span class="token punctuation">{</span>
  <span class="token property">default_name_prefix</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-web"</span>
  <span class="token property">name_prefix</span>         <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">name_prefix</span> <span class="token punctuation">!</span><span class="token punctuation">=</span> <span class="token string">""</span> <span class="token punctuation">?</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">name_prefix</span> <span class="token punctuation">:</span> <span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">default_name_prefix</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Local values can be interpolated elsewhere using the "local." prefix.</span>
<span class="token keyword">resource <span class="token type variable">"aws_s3_bucket"</span></span> <span class="token string">"files"</span> <span class="token punctuation">{</span>
  <span class="token property">bucket</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">name_prefix</span><span class="token punctuation">}</span></span>-files"</span>
  <span class="token comment"># ...</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h2>Provider</h2>
<ul>
<li>
<p><a href="https://www.terraform.io/docs/providers/index.html">providers</a></p>
</li>
<li>
<p>Providers are basically cloud providers as a service</p>
<ul>
<li>IaaS (infrastruture as a Service) like AWS, Azure, GCP</li>
<li>PaaS (Platform as a Service) like Heroku</li>
<li>SaaS (Software as a Service) like DNSimple, CloudFlare</li>
</ul>
</li>
<li>
<p><a href="https://www.terraform.io/docs/providers/aws/index.html">AWS</a></p>
<ul>
<li>you can pass in your access-key/secret-key via environment variables, or hardcoded (not recommended)</li>
</ul>
</li>
<li>
<p><a href="https://alimac.io/static-websites-with-s3-and-hugo-part-1/">tut</a></p>
</li>
<li>
<p>Different ways to define providers:</p>
<ol>
<li>aws creds</li>
</ol>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token comment"># access_key = "${var.aws_access_key}"</span>
  <span class="token comment"># secret_key = "${var.aws_secret_key}"</span>
  <span class="token property">region</span>     <span class="token punctuation">=</span> <span class="token string">"us-east-2"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<ol start="2">
<li>hard-coded:</li>
</ol>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span>     <span class="token punctuation">=</span> <span class="token string">"us-west-2"</span>
  <span class="token property">access_key</span> <span class="token punctuation">=</span> <span class="token string">"my-access-key"</span>
  <span class="token property">secret_key</span> <span class="token punctuation">=</span> <span class="token string">"my-secret-key"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<ol start="3">
<li>via Environment variables</li>
</ol>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token string">"anaccesskey"</span>
$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token string">"asecretkey"</span>
$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_DEFAULT_REGION</span><span class="token operator">=</span><span class="token string">"us-west-2"</span>
$ terraform plan
</code></pre></div>
<ol start="4">
<li>shared credentials:</li>
</ol>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span>                  <span class="token punctuation">=</span> <span class="token string">"us-west-2"</span>
  <span class="token property">shared_credentials_file</span> <span class="token punctuation">=</span> <span class="token string">"/Users/tf_user/.aws/creds"</span>
  <span class="token property">profile</span>                 <span class="token punctuation">=</span> <span class="token string">"customprofile"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<ul>
<li><a href="https://www.terraform.io/docs/configuration/providers.html#alias-multiple-provider-instances">using multiple providers</a></li>
</ul>
</li>
</ul>
<h2>Data</h2>
<ul>
<li>Get information on an existing resource</li>
<li>aws_route53_zone</li>
<li>aws_caller_identity</li>
<li>aws_acm_certificate</li>
</ul>
<h2>Resource</h2>
<ul>
<li>Create AWS resources:
<ul>
<li>aws_iam_policy_document</li>
<li>aws_acm_certificate</li>
<li>aws_acm_certificate_validation</li>
<li>aws_route53_record</li>
<li>aws_s3_bucket</li>
<li>aws_cloudfront_distribution</li>
<li>aws_cloudfront_origin_access_identity</li>
</ul>
</li>
<li>*** you can make a resource optionally if you pass in a count***
<ul>
<li>if you want the resource to be created if var.env == prod
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token property">count</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">env</span> <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"prod"</span> <span class="token punctuation">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>"</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<h2>Provisioners</h2>
<ul>
<li>used to execute scripts on a local or remote machine as part of the creation or destruction</li>
<li>creation-time provisioners
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"aws_instance"</span></span> <span class="token string">"web"</span> <span class="token punctuation">{</span>
  <span class="token comment"># ...</span>
  <span class="token keyword">provisioner<span class="token type variable"> "local-exec" </span></span><span class="token punctuation">{</span>
    <span class="token property">command</span> <span class="token punctuation">=</span> <span class="token string">"echo <span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token type variable">private_ip</span><span class="token punctuation">}</span></span> > file.txt"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>by default provisioners run when a resource is created, not during the updating or any other lifecycle</li>
<li>it is meant for bootstrapping a system</li>
<li>if a creation-time provisioner fails, the resource will be flagged as <em>tainted</em>, and will be planned for destruction upon the next <em>$ terraform apply</em></li>
<li>destroy-time provisioner
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"aws_instance"</span></span> <span class="token string">"web"</span> <span class="token punctuation">{</span>
  <span class="token comment"># ...</span>
  <span class="token keyword">provisioner<span class="token type variable"> "local-exec" </span></span><span class="token punctuation">{</span>
    <span class="token property">when</span>    <span class="token punctuation">=</span> <span class="token string">"destroy"</span>
    <span class="token property">command</span> <span class="token punctuation">=</span> <span class="token string">"echo 'Destroy-time provisioner'"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>multiple provisioners
<ul>
<li>you can add multiple provisioners and they will run in the order they are defined</li>
</ul>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"aws_instance"</span></span> <span class="token string">"web"</span> <span class="token punctuation">{</span>
  <span class="token comment"># ...</span>
  <span class="token keyword">provisioner<span class="token type variable"> "local-exec" </span></span><span class="token punctuation">{</span>
    <span class="token property">command</span> <span class="token punctuation">=</span> <span class="token string">"echo first"</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">provisioner<span class="token type variable"> "local-exec" </span></span><span class="token punctuation">{</span>
    <span class="token property">command</span> <span class="token punctuation">=</span> <span class="token string">"echo second"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h2>Outputs</h2>
<ul>
<li>
<p>You can print out the values that terraform will generate, when you run it with with <code>$ terraform output</code> it will output all the variable that is provided from the tfstate file</p>
</li>
<li>
<p>When you make a module you can define the <code>output</code> your module provides as getters</p>
</li>
<li>
<p>You can create bash variables from terraform <code>output</code></p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "bucket_name" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">s3_bucket_website_name</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">terraform apply -auto-approve
<span class="token assign-left variable">bucket_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>terraform output bucket_name<span class="token variable">)</span></span>
<span class="token function">npm</span> run build
aws s3 <span class="token function">rm</span> s3://<span class="token variable">$bucket_name</span>/  --recursive
aws s3 <span class="token function">sync</span> build/ s3://<span class="token variable">$bucket_name</span>/ --exclude <span class="token punctuation">\</span>"*.DS_Store*<span class="token punctuation">\</span>"
aws s3 <span class="token function">cp</span> build/index.html s3://<span class="token variable">$bucket_name</span>/ --cache-control max-age<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div>
</li>
</ul>
<h1>workspace</h1>
<ul>
<li><a href="https://www.terraform.io/docs/state/workspaces.html">docs</a></li>
<li>if you don't define a workspace then you only worked on the "default" workspace</li>
<li>defines how operations are executed</li>
<li>where persistent data are stored (for example terraform-state file)</li>
<li>Creating a new workspace:
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token assign-left variable">terraform_state_bucket</span><span class="token operator">=</span><span class="token string">"ngp-terraform-remote-config"</span>
$ terraform init -backend-config <span class="token assign-left variable">bucket</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${terraform_state_bucket}</span>"</span>

$ <span class="token assign-left variable">ENVIRONMENT</span><span class="token operator">=</span>dev
$ terraform workspace new <span class="token variable">$ENVIRONMENT</span>
</code></pre></div>
</li>
<li>Using an existing workspace:
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token assign-left variable">terraform_state_bucket</span><span class="token operator">=</span><span class="token string">"ngp-terraform-remote-config"</span>
$ terraform init -backend-config <span class="token assign-left variable">bucket</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${terraform_state_bucket}</span>"</span>

$ <span class="token assign-left variable">ENVIRONMENT</span><span class="token operator">=</span>dev
$ terraform workspace <span class="token keyword">select</span> <span class="token variable">$ENVIRONMENT</span>
</code></pre></div>
</li>
</ul>
<h1>Terraform auto-approve apply</h1>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ terraform apply -auto-approve
</code></pre></div>
<h2>Modules</h2>
<ul>
<li>
<p>Terraform ignores subfolders, in order to use subfolders you have to configure the subfolders to be a <code>terraform module</code>, then include those modules in your <code>main.tf</code> file.</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "custom_module" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"./modules/custom_module"</span>

  <span class="token property">app_name</span> <span class="token punctuation">=</span> <span class="token string">"app-name"</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Modules can be created locally or accessed at a url</p>
</li>
<li>
<p>It's like a class for terraform, it encapsulate a piece of configuration</p>
</li>
<li>
<p>A container for multiple resources that are used together.</p>
</li>
<li>
<p>Modules structure:</p>
<ol>
<li><strong>Input variables</strong></li>
</ol>
<ul>
<li>accept values from the calling modules</li>
</ul>
<ol start="2">
<li><strong>Output values</strong></li>
</ol>
<ul>
<li>returns values you can ues to populate arguments elsewhere</li>
</ul>
<ol start="3">
<li><strong>Resources</strong></li>
</ol>
<ul>
<li>define 1-or-more infrastructure objects that the module will manage.</li>
</ul>
</li>
<li>
<p>To define a module, create a new directory and place some <code>.tf</code> files inside of it</p>
</li>
<li>
<p>Terraform can load modules either from local relative paths (prefix with <code>./</code>) or from remote repositories</p>
<ul>
<li><code>"./"</code> prefix indicates that the address is a relative filesystem path.</li>
</ul>
</li>
<li>
<p>minimal folder structure:</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">.</span>
├── README.md
├── main.tf
├── variables.tf
├── outputs.tf
</code></pre></div>
</li>
<li>
<p>Standard structure with nested module</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">.</span>
├── README.md
├── main.tf
├── variables.tf
├── outputs.tf
├── <span class="token punctuation">..</span>.
├── modules/
│   ├── nestedA/
│   │   ├── README.md
│   │   ├── variables.tf
│   │   ├── main.tf
│   │   ├── outputs.tf
│   ├── nestedB/
</code></pre></div>
</li>
<li>
<p>Accessing the module's outputs you need to reference the module's outputs inside the root tf files. Example <code>./main.tf</code></p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "root_variable_output_val" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> <span class="token string">"Hello from the root tf"</span>
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "module_variable_output_val" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> module.some_awesome_module
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Calling modules <code>module.&#x3C;MODULE_NAME>.&#x3C;OUPUT_VALUE></code></p>
</li>
<li>
<p><a href="https://www.terraform.io/docs/modules/sources.html">source modules</a></p>
<ul>
<li>module installer supports:
<ul>
<li>Local paths</li>
<li>Terraform Registry</li>
<li>GitHub</li>
<li>BitbucketGeneric Git, Mercurial repositories</li>
<li>HTTP URLs</li>
<li>S3 buckets</li>
<li>GCS buckets</li>
</ul>
</li>
<li>example of using modules source
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "consul" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"./consul"</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>example of using modules source
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "consul" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"../module_at_parent_level"</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p><a href="https://github.com/azavea/terraform-aws-acm-certificate">terraform-aws-acm-certificate</a></p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">"us-east-1"</span>
  <span class="token property">alias</span>  <span class="token punctuation">=</span> <span class="token string">"certificates"</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">"us-west-2"</span>
  <span class="token property">alias</span>  <span class="token punctuation">=</span> <span class="token string">"dns"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_route53_zone"</span></span> <span class="token string">"default"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">"azavea.com"</span>
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "cert" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"github.com/azavea/terraform-aws-acm-certificate?ref=1.1.0"</span>

  <span class="token property">providers</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">aws.acm_account</span>     <span class="token punctuation">=</span> <span class="token string">"aws.certificates"</span>
    <span class="token property">aws.route53_account</span> <span class="token punctuation">=</span> <span class="token string">"aws.dns"</span>
  <span class="token punctuation">}</span>

  <span class="token property">domain_name</span>                       <span class="token punctuation">=</span> <span class="token string">"azavea.com"</span>
  <span class="token property">subject_alternative_names</span>         <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"*.azavea.com"</span><span class="token punctuation">]</span>
  <span class="token property">hosted_zone_id</span>                    <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_route53_zone<span class="token punctuation">.</span>default<span class="token punctuation">.</span>zone_id<span class="token punctuation">}</span></span>"</span>
  <span class="token property">validation_record_ttl</span>             <span class="token punctuation">=</span> <span class="token string">"60"</span>
  <span class="token property">allow_validation_record_overwrite</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p><strong>NOTE:</strong> <em>If you want to conditionally use a module</em>, Terraform 0.13 allows you do add a count to a module. You might want to use this if you only want a module to run in a specific deployment environment</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> forProd </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token keyword">resource <span class="token type variable">"resource_type"</span></span> <span class="token string">"resource_name"</span> <span class="token punctuation">{</span>
 <span class="token property">count</span> <span class="token punctuation">=</span> var.forProd ? <span class="token number">1</span> : <span class="token number">0</span>
 ... other resource properties 
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h1>Terraform for New Relic Dashboard</h1>
<ul>
<li>
<p>Assign some variables to the new-relic account id &#x26; api-key</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> account_id </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">variable<span class="token type variable"> api_key </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>terraform block &#x26; newrelic provider</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token property">required_version</span> <span class="token punctuation">=</span> <span class="token string">">= 0.13.5"</span>
  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
    <span class="token property">newrelic</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"newrelic/newrelic"</span>
      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">"~> 2.21.0"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "newrelic" </span></span><span class="token punctuation">{</span>
  <span class="token property">account_id</span> <span class="token punctuation">=</span> var.account_id
  <span class="token property">api_key</span>    <span class="token punctuation">=</span> var.api_key
  <span class="token property">region</span>     <span class="token punctuation">=</span> <span class="token string">"US"</span> <span class="token comment"># Valid regions are US and EU</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Create a new relic one dashboard</p>
<div class="remark-highlight"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"newrelic_one_dashboard"</span></span> <span class="token string">"nark_dashboard"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> var.dashboard_name

  <span class="token keyword">page</span> <span class="token punctuation">{</span>
    <span class="token property">name</span> <span class="token punctuation">=</span> var.dashboard_name

    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">1</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">1</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# A"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">1</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">5</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# B"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">1</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">9</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# C"</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">5</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">1</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# D"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">5</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">5</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# E"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">widget_markdown</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>  <span class="token punctuation">=</span> <span class="token string">"Dashboard Note"</span>
      <span class="token property">row</span>    <span class="token punctuation">=</span> <span class="token number">5</span>
      <span class="token property">column</span> <span class="token punctuation">=</span> <span class="token number">6</span>
      <span class="token property">text</span> <span class="token punctuation">=</span> <span class="token string">"# F"</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>Pass in the newrelic account/api-key which running the terraform script</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token assign-left variable">NR_ACCOUNT_NUMBER</span><span class="token operator">=</span><span class="token string">"****"</span>
$ <span class="token assign-left variable">NR_API_KEY</span><span class="token operator">=</span><span class="token string">"****"</span>

$ terraform plan <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"account_id=<span class="token variable">$NR_ACCOUNT_NUMBER</span>"</span> <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"api_key=<span class="token variable">$NR_API_KEY</span>"</span>

$ terraform apply -auto-approve <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"account_id=<span class="token variable">$NR_ACCOUNT_NUMBER</span>"</span> <span class="token punctuation">\</span>
  -var<span class="token operator">=</span><span class="token string">"api_key=<span class="token variable">$NR_API_KEY</span>"</span>
</code></pre></div>
</li>
</ul>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="/">Learn something else</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"terraform","slug":"terraform","content":"\u003ch2\u003eWhat is Terraform\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eTerraform is \u003ccode\u003eInfrasture as code\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOther \"infrasture-as-code\" are: chef, puppet, anisble, SaltStack, CloudFoundation\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe major building pieces to TF are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003evariable (variables)\u003c/li\u003e\n\u003cli\u003elocals (variables with interpellation)\u003c/li\u003e\n\u003cli\u003eprovider (aws|azure|google)\u003c/li\u003e\n\u003cli\u003eprovisioners (execute scripts on a local or remote machine as part of the creation or destruction)\u003c/li\u003e\n\u003cli\u003edata (get information on existing services)\u003c/li\u003e\n\u003cli\u003eresource (create resource)\u003c/li\u003e\n\u003cli\u003emodule (isolate configuration)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLinks:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.gruntwork.io/an-introduction-to-terraform-f17df9c6d180\"\u003eintro\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://medium.com/@pavloosadchyi/terraform-patterns-and-tricks-i-use-every-day-117861531173\"\u003emedium post\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTerraform is \u003ccode\u003edeclarative\u003c/code\u003e, it says \"I declare therefore i am\"\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003enon-Terraform services do not get auto-magicly added to your state, Terraform only tracks the things it makes\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003econfigurations: i declare the intent\u003c/li\u003e\n\u003cli\u003eState: current state\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edry run \u003ccode\u003e$ terraform plan\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE\u003c/strong\u003e Terraform ignores subfolders, in order to use subfolders you have to configure the subfolders to be a \u003ccode\u003eterraform module\u003c/code\u003e, then include those modules in your \u003ccode\u003emain.tf\u003c/code\u003e file\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eInstall\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eYou can install TF with homebrew but it's better to install it with \u003ccode\u003etfswitch\u003c/code\u003e with homebrew\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://warrensbox.github.io/terraform-switcher/\"\u003eTerraform version manager\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003ethis will allow you to switch version very easily\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ brew install warrensbox/tap/tfswitch\n$ tfswitch 0.12.4\n$ terraform -v\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eSave remote-state in S3\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.terraform.io/docs/backends/types/s3.html\"\u003edocs\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIt is highly recommended that you enable Bucket Versioning on the S3 bucket to allow for state recovery in the case of accidental deletions and human error.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePaths to the state file inside the bucket: \u003cem\u003e\u003ccode\u003e\u0026#x3C;bucket\u003e/\u0026#x3C;workspace_key_prefix\u003e/\u0026#x3C;workspace_name\u003e/\u0026#x3C;key\u003e\u003c/code\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\"Amazon S3\"/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eBUCKET_NAME_FOR_TF_STATE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e/env:/dev/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eTF_STATE_KEY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\"Amazon S3\"/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eBUCKET_NAME_FOR_TF_STATE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e/env:/staging/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eTF_STATE_KEY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\"Amazon S3\"/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eBUCKET_NAME_FOR_TF_STATE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e/env:/prod/\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eTF_STATE_KEY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHere is the format for the terraform remote state code block\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ebackend\u003cspan class=\"token type variable\"\u003e \"s3\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ebucket\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"mybucket\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ekey\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"path/to/my/key\"\u003c/span\u003e     \u003cspan class=\"token comment\"\u003e# \u0026#x3C;TF_STATE_KEY\u003e, it can just be a single string\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-east-1\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHere is an example for the terraform remote state code block\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ebackend\u003cspan class=\"token type variable\"\u003e \"s3\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ekey\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"someawesomesite\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-west-2\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003erequired_version\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003e= 0.13.5\"\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003erequired_providers\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eaws\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003esource\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003eversion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"~\u003e3.4\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eKey: the path to the state file inside the bucket. When using a non-default workspace, the state path will be /workspace_key_prefix/workspace_name/key\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003edata \u003cspan class=\"token type variable\"\u003e\"terraform_remote_state\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"network\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ebackend\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"s3\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003econfig\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ebucket\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"terraform-state-prod\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ekey\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"network/terraform.tfstate\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-east-1\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOr you can have a blank terraform.backend and configure it with bash command\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token assign-left variable\"\u003estate_key\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"prod/some-app/\u003cspan class=\"token variable\"\u003e${ENVIRONMENT}\u003c/span\u003e.tfstate\"\u003c/span\u003e\nterraform init \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -backend-config \u003cspan class=\"token assign-left variable\"\u003ebucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"my-terraform-state-bucket\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -backend-config\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"key=\u003cspan class=\"token variable\"\u003e${state_key}\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -backend-config\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"encrypt=true\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -backend-config\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"region=us-west-2\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ebackend\u003cspan class=\"token type variable\"\u003e \"s3\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eTerraform CLI\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.terraform.io/docs/commands/index.html\"\u003eTerraform CLI\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e$ terraform workspace (list|select|new|delete|show)\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ terraform init\n$ terraform validate\n$ terraform \u003cspan class=\"token function\"\u003efmt\u003c/span\u003e   \u003cspan class=\"token comment\"\u003e# format all terraform at the current folder level \u003c/span\u003e\n$ terraform plan\n$ terraform apply\n$ terraform apply -auto-approve\n$ terraform output\n$ terraform workspace\n\n$ terraform \u003cspan class=\"token function\"\u003eimport\u003c/span\u003e aws_s3_bucket.bucket \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003ebucket-name\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe terraform output command is used to extract the value of an output variable from the state file.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ terraform plan\n$ terraform output\n\n$ \u003cspan class=\"token builtin class-name\"\u003ecd\u003c/span\u003e to-base-of-tf-directory\n$ terraform output\n\n$ terraform workspace \u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e prod \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e terraform refresh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eTerraform Plugins\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eTerraform relies on plugins called \"providers\" to interact with remote systems\u003c/li\u003e\n\u003cli\u003eDefining your providers:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003erequired_providers\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003emycloud\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003esource\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"mycorp/mycloud\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003eversion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"~\u003e 1.0\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003erequired_providers\u003c/code\u003e block must be nested inside the top-level \u003ccode\u003eterraform\u003c/code\u003e block (which can also contain other settings).\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://registry.terraform.io/namespaces/hashicorp\"\u003emain providers\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eLifecycle management of AWS resources, including EC2, Lambda, EKS, ECS, VPC, S3, RDS, DynamoDB, and more. This provider is maintained internally by the HashiCorp AWS Provider team.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eVariable\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eYou can define variables and provide \u003ccode\u003etype\u003c/code\u003e, \u003ccode\u003edefault\u003c/code\u003e value, \u003ccode\u003edescription\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eVaraibles have to be hard-coded (you cannot interpolating values)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e \"some_variable\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e string\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"hello\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edescription\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"This is an example of a variable that has a string type\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBasic variable types are: string/list/map:\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe basic structure of defining a variable is:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e \"some_key\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026#x3C;string|list|map\u003e\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026#x3C;SOME_DEFAULT_VALUE\u003e\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAll variables used have to be defined beforehand\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eExample of the 3 basic types:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eString\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e some_string \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"string\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"hello terraform string\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edescription\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"this is a simple string\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Use into the resource\u003c/span\u003e\n\u003cspan class=\"token property\"\u003esome-parameter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \"$\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003evar.some_string\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eList\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e some_list \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"list\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"subnet1\"\u003c/span\u003e,\n    \u003cspan class=\"token string\"\u003e\"subnet2\"\u003c/span\u003e,\n    \u003cspan class=\"token string\"\u003e\"subnet3\"\u003c/span\u003e,\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edescription\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"this is a list\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Use into the resource\u003c/span\u003e\n\u003cspan class=\"token property\"\u003esome-parameter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \"$\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003evar.some_list\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eMap\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e some_map \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"map\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003esubnet1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"subnet1\"\u003c/span\u003e,\n    \u003cspan class=\"token property\"\u003esubnet2\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"subnet2\"\u003c/span\u003e,\n    \u003cspan class=\"token property\"\u003esubnet3\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"subnet3\"\u003c/span\u003e,\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edescription\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"this is a map\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Use into the resource\u003c/span\u003e\n\u003cspan class=\"token property\"\u003esome-parameter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \"$\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003evar.some_map\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"subnet1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003enull\u003c/code\u003e value is a special value that has no type\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ea value that represents absence or omission\u003c/li\u003e\n\u003cli\u003eIf you set an argument of a resource or module to null, Terraform behaves as though you had completely omitted it\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhen you run terraform all the empty variables (ones without a default value) if not provided in the command will be asked before terraform does it magic.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou can also override any variables by passing in them as a flag when you run a terraform command\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ terraform apply -var \u003cspan class=\"token assign-left variable\"\u003esome_key\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"this rocks\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eProviding a \u003ccode\u003eVariables File\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAll \u003ccode\u003e*.tfvars\u003c/code\u003e will get picked up when you run terraform, sometimes you want to load specific variable files based on the environment you want to deploy so passing supply \u003ccode\u003e-var-file=\u0026#x3C;FILE_NAME\u003e.tfvars\u003c/code\u003e with variable values might a great way to deal with different variables for different environments\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etfvar\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token property\"\u003edomain_suffix\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"-dev\"\u003c/span\u003e\n\u003cspan class=\"token property\"\u003ehosted_zone_name\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"someawesomesite.com\"\u003c/span\u003e\n\u003cspan class=\"token property\"\u003eenv_tag\u003c/span\u003e          \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Development\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emain.tf\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e domain_suffix \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e hosted_zone_name \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e env_tag \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePlan\u003c/code\u003e script\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e# `plan.sh` script to run a plan\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eWORKSPACE\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"dev\"\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eVAR_FILE\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"./env_configs/dev.tfvars\"\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eterraform_state_bucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u0026#x3C;TERRAFORM_S3_STATE_BUCKET\u003e\"\u003c/span\u003e\n\u003cspan class=\"token function\"\u003erm\u003c/span\u003e -rf .terraform/\nterraform init -backend-config \u003cspan class=\"token assign-left variable\"\u003ebucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token variable\"\u003e${terraform_state_bucket}\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e terraform workspace \u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token variable\"\u003e${WORKSPACE}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n  terraform workspace new \u003cspan class=\"token variable\"\u003e${WORKSPACE}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efi\u003c/span\u003e\nterraform plan -var-file\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$VAR_FILE\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou can provide variables via the terminal\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003eterraform apply -auto-approve \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SOME_VAR_NAME=SOME_VALUE\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SOME_OTHER_VAR_NAME=SOME_VALUE\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e \"SOME_VAR_NAME\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e string\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e \"SOME_OTHER_VAR_NAME\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003etype\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e string\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eLocals (Local Value Configuration)\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003elocals are like variables that you can pass in ${dynamic} values\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eA local value assigns a name to an expression, so you can use it multiple times within a module without repeating it.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDRY principles, allows you to preform logic to create a value where you don't have to write every time\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou can also reference the a local variable inside the locals code block\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eeg of locals\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003elocals\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ebucket_name\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token function\"\u003ereplace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003eapp_namespace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"_\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"-\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e-\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003eworkspace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e-client\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edomain_name\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003edomain_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003edomain_suffix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003ehosted_zone_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token comment\"\u003e# Ids for multiple sets of EC2 instances, merged together\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elocals\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003einstance_ids\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token function\"\u003econcat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaws_instance\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e aws_instance\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egreen\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# A computed default name prefix\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elocals\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault_name_prefix\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003eproject_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e-web\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ename_prefix\u003c/span\u003e         \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003ename_prefix\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e?\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003ename_prefix\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elocal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003edefault_name_prefix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Local values can be interpolated elsewhere using the \"local.\" prefix.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"aws_s3_bucket\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"files\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ebucket\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003elocal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003ename_prefix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e-files\"\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eProvider\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.terraform.io/docs/providers/index.html\"\u003eproviders\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eProviders are basically cloud providers as a service\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIaaS (infrastruture as a Service) like AWS, Azure, GCP\u003c/li\u003e\n\u003cli\u003ePaaS (Platform as a Service) like Heroku\u003c/li\u003e\n\u003cli\u003eSaaS (Software as a Service) like DNSimple, CloudFlare\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.terraform.io/docs/providers/aws/index.html\"\u003eAWS\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eyou can pass in your access-key/secret-key via environment variables, or hardcoded (not recommended)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://alimac.io/static-websites-with-s3-and-hugo-part-1/\"\u003etut\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDifferent ways to define providers:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eaws creds\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# access_key = \"${var.aws_access_key}\"\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# secret_key = \"${var.aws_secret_key}\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e     \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-east-2\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003ehard-coded:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e     \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-west-2\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eaccess_key\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"my-access-key\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esecret_key\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"my-secret-key\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003evia Environment variables\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003eAWS_ACCESS_KEY_ID\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"anaccesskey\"\u003c/span\u003e\n$ \u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003eAWS_SECRET_ACCESS_KEY\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"asecretkey\"\u003c/span\u003e\n$ \u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003eAWS_DEFAULT_REGION\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"us-west-2\"\u003c/span\u003e\n$ terraform plan\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eshared credentials:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e                  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-west-2\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eshared_credentials_file\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/Users/tf_user/.aws/creds\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eprofile\u003c/span\u003e                 \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"customprofile\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.terraform.io/docs/configuration/providers.html#alias-multiple-provider-instances\"\u003eusing multiple providers\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eData\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eGet information on an existing resource\u003c/li\u003e\n\u003cli\u003eaws_route53_zone\u003c/li\u003e\n\u003cli\u003eaws_caller_identity\u003c/li\u003e\n\u003cli\u003eaws_acm_certificate\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eResource\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCreate AWS resources:\n\u003cul\u003e\n\u003cli\u003eaws_iam_policy_document\u003c/li\u003e\n\u003cli\u003eaws_acm_certificate\u003c/li\u003e\n\u003cli\u003eaws_acm_certificate_validation\u003c/li\u003e\n\u003cli\u003eaws_route53_record\u003c/li\u003e\n\u003cli\u003eaws_s3_bucket\u003c/li\u003e\n\u003cli\u003eaws_cloudfront_distribution\u003c/li\u003e\n\u003cli\u003eaws_cloudfront_origin_access_identity\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e*** you can make a resource optionally if you pass in a count***\n\u003cul\u003e\n\u003cli\u003eif you want the resource to be created if var.env == prod\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token property\"\u003ecount\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003eenv\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"prod\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e?\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eProvisioners\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eused to execute scripts on a local or remote machine as part of the creation or destruction\u003c/li\u003e\n\u003cli\u003ecreation-time provisioners\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"aws_instance\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"web\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprovisioner\u003cspan class=\"token type variable\"\u003e \"local-exec\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ecommand\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"echo \u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003eprivate_ip\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003e file.txt\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eby default provisioners run when a resource is created, not during the updating or any other lifecycle\u003c/li\u003e\n\u003cli\u003eit is meant for bootstrapping a system\u003c/li\u003e\n\u003cli\u003eif a creation-time provisioner fails, the resource will be flagged as \u003cem\u003etainted\u003c/em\u003e, and will be planned for destruction upon the next \u003cem\u003e$ terraform apply\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003edestroy-time provisioner\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"aws_instance\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"web\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprovisioner\u003cspan class=\"token type variable\"\u003e \"local-exec\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ewhen\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"destroy\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ecommand\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"echo 'Destroy-time provisioner'\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003emultiple provisioners\n\u003cul\u003e\n\u003cli\u003eyou can add multiple provisioners and they will run in the order they are defined\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"aws_instance\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"web\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprovisioner\u003cspan class=\"token type variable\"\u003e \"local-exec\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ecommand\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"echo first\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprovisioner\u003cspan class=\"token type variable\"\u003e \"local-exec\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ecommand\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"echo second\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eOutputs\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eYou can print out the values that terraform will generate, when you run it with with \u003ccode\u003e$ terraform output\u003c/code\u003e it will output all the variable that is provided from the tfstate file\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhen you make a module you can define the \u003ccode\u003eoutput\u003c/code\u003e your module provides as getters\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou can create bash variables from terraform \u003ccode\u003eoutput\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eoutput\u003cspan class=\"token type variable\"\u003e \"bucket_name\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003evalue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003elocal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token type variable\"\u003es3_bucket_website_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003eterraform apply -auto-approve\n\u003cspan class=\"token assign-left variable\"\u003ebucket_name\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e$(\u003c/span\u003eterraform output bucket_name\u003cspan class=\"token variable\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token function\"\u003enpm\u003c/span\u003e run build\naws s3 \u003cspan class=\"token function\"\u003erm\u003c/span\u003e s3://\u003cspan class=\"token variable\"\u003e$bucket_name\u003c/span\u003e/  --recursive\naws s3 \u003cspan class=\"token function\"\u003esync\u003c/span\u003e build/ s3://\u003cspan class=\"token variable\"\u003e$bucket_name\u003c/span\u003e/ --exclude \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\"*.DS_Store*\u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\"\naws s3 \u003cspan class=\"token function\"\u003ecp\u003c/span\u003e build/index.html s3://\u003cspan class=\"token variable\"\u003e$bucket_name\u003c/span\u003e/ --cache-control max-age\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eworkspace\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.terraform.io/docs/state/workspaces.html\"\u003edocs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eif you don't define a workspace then you only worked on the \"default\" workspace\u003c/li\u003e\n\u003cli\u003edefines how operations are executed\u003c/li\u003e\n\u003cli\u003ewhere persistent data are stored (for example terraform-state file)\u003c/li\u003e\n\u003cli\u003eCreating a new workspace:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token assign-left variable\"\u003eterraform_state_bucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ngp-terraform-remote-config\"\u003c/span\u003e\n$ terraform init -backend-config \u003cspan class=\"token assign-left variable\"\u003ebucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token variable\"\u003e${terraform_state_bucket}\u003c/span\u003e\"\u003c/span\u003e\n\n$ \u003cspan class=\"token assign-left variable\"\u003eENVIRONMENT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003edev\n$ terraform workspace new \u003cspan class=\"token variable\"\u003e$ENVIRONMENT\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eUsing an existing workspace:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token assign-left variable\"\u003eterraform_state_bucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ngp-terraform-remote-config\"\u003c/span\u003e\n$ terraform init -backend-config \u003cspan class=\"token assign-left variable\"\u003ebucket\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token variable\"\u003e${terraform_state_bucket}\u003c/span\u003e\"\u003c/span\u003e\n\n$ \u003cspan class=\"token assign-left variable\"\u003eENVIRONMENT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003edev\n$ terraform workspace \u003cspan class=\"token keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$ENVIRONMENT\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eTerraform auto-approve apply\u003c/h1\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ terraform apply -auto-approve\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eModules\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eTerraform ignores subfolders, in order to use subfolders you have to configure the subfolders to be a \u003ccode\u003eterraform module\u003c/code\u003e, then include those modules in your \u003ccode\u003emain.tf\u003c/code\u003e file.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003emodule\u003cspan class=\"token type variable\"\u003e \"custom_module\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esource\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./modules/custom_module\"\u003c/span\u003e\n\n  \u003cspan class=\"token property\"\u003eapp_name\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"app-name\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eModules can be created locally or accessed at a url\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIt's like a class for terraform, it encapsulate a piece of configuration\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eA container for multiple resources that are used together.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eModules structure:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eInput variables\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eaccept values from the calling modules\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e\u003cstrong\u003eOutput values\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003ereturns values you can ues to populate arguments elsewhere\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\u003cstrong\u003eResources\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003edefine 1-or-more infrastructure objects that the module will manage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTo define a module, create a new directory and place some \u003ccode\u003e.tf\u003c/code\u003e files inside of it\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTerraform can load modules either from local relative paths (prefix with \u003ccode\u003e./\u003c/code\u003e) or from remote repositories\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\"./\"\u003c/code\u003e prefix indicates that the address is a relative filesystem path.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eminimal folder structure:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n├── README.md\n├── main.tf\n├── variables.tf\n├── outputs.tf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eStandard structure with nested module\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n├── README.md\n├── main.tf\n├── variables.tf\n├── outputs.tf\n├── \u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n├── modules/\n│   ├── nestedA/\n│   │   ├── README.md\n│   │   ├── variables.tf\n│   │   ├── main.tf\n│   │   ├── outputs.tf\n│   ├── nestedB/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAccessing the module's outputs you need to reference the module's outputs inside the root tf files. Example \u003ccode\u003e./main.tf\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eoutput\u003cspan class=\"token type variable\"\u003e \"root_variable_output_val\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003evalue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Hello from the root tf\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eoutput\u003cspan class=\"token type variable\"\u003e \"module_variable_output_val\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003evalue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e module.some_awesome_module\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCalling modules \u003ccode\u003emodule.\u0026#x3C;MODULE_NAME\u003e.\u0026#x3C;OUPUT_VALUE\u003e\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.terraform.io/docs/modules/sources.html\"\u003esource modules\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emodule installer supports:\n\u003cul\u003e\n\u003cli\u003eLocal paths\u003c/li\u003e\n\u003cli\u003eTerraform Registry\u003c/li\u003e\n\u003cli\u003eGitHub\u003c/li\u003e\n\u003cli\u003eBitbucketGeneric Git, Mercurial repositories\u003c/li\u003e\n\u003cli\u003eHTTP URLs\u003c/li\u003e\n\u003cli\u003eS3 buckets\u003c/li\u003e\n\u003cli\u003eGCS buckets\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eexample of using modules source\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003emodule\u003cspan class=\"token type variable\"\u003e \"consul\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esource\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./consul\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eexample of using modules source\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003emodule\u003cspan class=\"token type variable\"\u003e \"consul\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esource\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"../module_at_parent_level\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/azavea/terraform-aws-acm-certificate\"\u003eterraform-aws-acm-certificate\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-east-1\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ealias\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"certificates\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"aws\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"us-west-2\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ealias\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"dns\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"aws_route53_zone\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"default\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ename\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"azavea.com\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003emodule\u003cspan class=\"token type variable\"\u003e \"cert\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esource\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"github.com/azavea/terraform-aws-acm-certificate?ref=1.1.0\"\u003c/span\u003e\n\n  \u003cspan class=\"token property\"\u003eproviders\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eaws.acm_account\u003c/span\u003e     \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"aws.certificates\"\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003eaws.route53_account\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"aws.dns\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token property\"\u003edomain_name\u003c/span\u003e                       \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"azavea.com\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esubject_alternative_names\u003c/span\u003e         \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"*.azavea.com\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ehosted_zone_id\u003c/span\u003e                    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eaws_route53_zone\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edefault\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezone_id\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003evalidation_record_ttl\u003c/span\u003e             \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"60\"\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eallow_validation_record_overwrite\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE:\u003c/strong\u003e \u003cem\u003eIf you want to conditionally use a module\u003c/em\u003e, Terraform 0.13 allows you do add a count to a module. You might want to use this if you only want a module to run in a specific deployment environment\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e forProd \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"resource_type\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"resource_name\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n \u003cspan class=\"token property\"\u003ecount\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e var.forProd ? \u003cspan class=\"token number\"\u003e1\u003c/span\u003e : \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n ... other resource properties \n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eTerraform for New Relic Dashboard\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAssign some variables to the new-relic account id \u0026#x26; api-key\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e account_id \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evariable\u003cspan class=\"token type variable\"\u003e api_key \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eterraform block \u0026#x26; newrelic provider\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eterraform\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003erequired_version\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003e= 0.13.5\"\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003erequired_providers\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003enewrelic\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003esource\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"newrelic/newrelic\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003eversion\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"~\u003e 2.21.0\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprovider\u003cspan class=\"token type variable\"\u003e \"newrelic\" \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eaccount_id\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e var.account_id\n  \u003cspan class=\"token property\"\u003eapi_key\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e var.api_key\n  \u003cspan class=\"token property\"\u003eregion\u003c/span\u003e     \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"US\"\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# Valid regions are US and EU\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate a new relic one dashboard\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-hcl\"\u003e\u003ccode class=\"language-hcl\"\u003e\u003cspan class=\"token keyword\"\u003eresource \u003cspan class=\"token type variable\"\u003e\"newrelic_one_dashboard\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nark_dashboard\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003ename\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e var.dashboard_name\n\n  \u003cspan class=\"token keyword\"\u003epage\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003ename\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e var.dashboard_name\n\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# A\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# B\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e9\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# C\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# D\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# E\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewidget_markdown\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etitle\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Dashboard Note\"\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003erow\u003c/span\u003e    \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e6\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003etext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"# F\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePass in the newrelic account/api-key which running the terraform script\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token assign-left variable\"\u003eNR_ACCOUNT_NUMBER\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"****\"\u003c/span\u003e\n$ \u003cspan class=\"token assign-left variable\"\u003eNR_API_KEY\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"****\"\u003c/span\u003e\n\n$ terraform plan \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"account_id=\u003cspan class=\"token variable\"\u003e$NR_ACCOUNT_NUMBER\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"api_key=\u003cspan class=\"token variable\"\u003e$NR_API_KEY\u003c/span\u003e\"\u003c/span\u003e\n\n$ terraform apply -auto-approve \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"account_id=\u003cspan class=\"token variable\"\u003e$NR_ACCOUNT_NUMBER\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n  -var\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"api_key=\u003cspan class=\"token variable\"\u003e$NR_API_KEY\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","ogImage":{"url":"/assets/covers/terraform.jpg"},"coverImage":"/assets/covers/terraform.jpg"}},"__N_SSG":true},"page":"/learn/[slug]","query":{"slug":"terraform"},"buildId":"xc8aRO_UA-dU8jLLoNe4O","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-c5113a73163ba9a6512c.js" async=""></script><script src="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" async=""></script><script src="/_next/static/chunks/pages/_app-65342bae310ab86b4830.js" async=""></script><script src="/_next/static/chunks/664-aaadba6b31e09bfd632a.js" async=""></script><script src="/_next/static/chunks/pages/learn/%5Bslug%5D-696d4f00a359e13ae662.js" async=""></script><script src="/_next/static/xc8aRO_UA-dU8jLLoNe4O/_buildManifest.js" async=""></script><script src="/_next/static/xc8aRO_UA-dU8jLLoNe4O/_ssgManifest.js" async=""></script></body></html>