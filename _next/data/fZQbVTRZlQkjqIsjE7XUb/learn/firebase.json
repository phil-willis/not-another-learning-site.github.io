{"pageProps":{"post":{"title":"firebase","slug":"firebase","content":"<h1>Overview of firebase</h1>\n<ul>\n<li><a href=\"https://firebase.google.com/docs/build\">firebase docs</a></li>\n</ul>\n<h2>Auth</h2>\n<ul>\n<li>When it comes to authentication there are multiple types that can be wired up quite easily</li>\n<li>Available options:\n<ul>\n<li>email/password</li>\n<li>Google</li>\n<li>Apple</li>\n<li>Facebook</li>\n<li>Twitter</li>\n<li>Github</li>\n</ul>\n</li>\n<li>You can also have anonymous auth</li>\n</ul>\n<h1>FireStore</h1>\n<ul>\n<li>\n<p>Production mode</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">rules_version <span class=\"token operator\">=</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">;</span>\nservice cloud<span class=\"token punctuation\">.</span><span class=\"token property-access\">firestore</span> <span class=\"token punctuation\">{</span>\n  match <span class=\"token operator\">/</span>databases<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>database<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>documents <span class=\"token punctuation\">{</span>\n    match <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token dom variable\">document</span><span class=\"token operator\">=</span><span class=\"token operator\">**</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n      allow read<span class=\"token punctuation\">,</span> write<span class=\"token operator\">:</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n</li>\n<li>\n<p>Testing mode</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">rules_version <span class=\"token operator\">=</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">;</span>\nservice cloud<span class=\"token punctuation\">.</span><span class=\"token property-access\">firestore</span> <span class=\"token punctuation\">{</span>\n  match <span class=\"token operator\">/</span>databases<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>database<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>documents <span class=\"token punctuation\">{</span>\n    match <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token dom variable\">document</span><span class=\"token operator\">=</span><span class=\"token operator\">**</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n      allow read<span class=\"token punctuation\">,</span> write<span class=\"token operator\">:</span> <span class=\"token keyword control-flow\">if</span>\n          request<span class=\"token punctuation\">.</span><span class=\"token property-access\">time</span> <span class=\"token operator\">&#x3C;</span> timestamp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">date</span><span class=\"token punctuation\">(</span><span class=\"token number\">2021</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n</li>\n</ul>\n<h1>Adding Geospatial to your DB</h1>\n<ul>\n<li>\n<p>Start by adding some npm packages</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> init -y\n<span class=\"token function\">npm</span> i firebase-admin geofirex\n</code></pre></div>\n</li>\n<li>\n<p>Create a file to seed the database</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> admin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"firebase-admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> serviceAccount <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./firebase-creds.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nadmin<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">initializeApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  credential<span class=\"token operator\">:</span> admin<span class=\"token punctuation\">.</span><span class=\"token property-access\">credential</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cert</span><span class=\"token punctuation\">(</span>serviceAccount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  databaseURL<span class=\"token operator\">:</span> <span class=\"token string\">\"https://&#x3C;FIREBASE_PROJECT_NAME>.firebaseio.com\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Init GeoFireX</span>\n<span class=\"token keyword\">const</span> geofirex <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"geofirex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> geo <span class=\"token operator\">=</span> geofirex<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">init</span><span class=\"token punctuation\">(</span>admin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> pinsRef <span class=\"token operator\">=</span> admin<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">firestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pins\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add some markers</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Phoenix\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">119</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Portland\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">45.52054</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">122.6795</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Vancouver\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">49.2827</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">123.1207</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Seattle\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">47.604311</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">122.33551</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"San Francisco\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.771800273</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">122.416534</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Ottawa\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">45.42062</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">75.697174</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npinsRef<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Victoria\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">48.426922</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">123.36341</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n</li>\n<li>\n<p>Now you can make queries against your table</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> admin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"firebase-admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> serviceAccount <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./firebase-creds.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nadmin<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">initializeApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  credential<span class=\"token operator\">:</span> admin<span class=\"token punctuation\">.</span><span class=\"token property-access\">credential</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cert</span><span class=\"token punctuation\">(</span>serviceAccount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  databaseURL<span class=\"token operator\">:</span> <span class=\"token string\">\"https://&#x3C;FIREBASE_PROJECT_NAME>.firebaseio.com\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Init GeoFireX</span>\n<span class=\"token keyword\">const</span> geofirex <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"geofirex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> geo <span class=\"token operator\">=</span> geofirex<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">init</span><span class=\"token punctuation\">(</span>admin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> pinsRef <span class=\"token operator\">=</span> admin<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">firestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pins\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Query wthin</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getPointsWithin</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> center<span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">,</span> field <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">query</span><span class=\"token punctuation\">(</span>pinsRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">within</span><span class=\"token punctuation\">(</span>center<span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">,</span> field<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> log<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> obs <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>geofirex<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toGeoJSON</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"position\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> geojson <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> geofirex<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>obs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> geojson<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">getPointsWithin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  center<span class=\"token operator\">:</span> geo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">point</span><span class=\"token punctuation\">(</span><span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">122</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  radius<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//km</span>\n  field<span class=\"token operator\">:</span> <span class=\"token string\">\"position\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n</li>\n</ul>\n","ogImage":{"url":"/assets/blog/hello-world/cover.jpg"},"coverImage":"/assets/blog/hello-world/cover.jpg"}},"__N_SSG":true}