<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Not another learning site."/><meta property="og:image" content="https://og-image.now.sh/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Not another learning site.</title><meta property="og:image" content="/assets/covers/docker.jpg"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/77dd4697d85c4685.css" as="style"/><link rel="stylesheet" href="/_next/static/css/77dd4697d85c4685.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cf121497002c184d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cf121497002c184d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-779b41245c009d2a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-156acf25c3b6001c.js" defer=""></script><script src="/_next/static/chunks/664-4243e6d8b13d56da.js" defer=""></script><script src="/_next/static/chunks/pages/learn/%5Bslug%5D-f7c40571bdb12048.js" defer=""></script><script src="/_next/static/efznPjd9fe3AImm5u1s3h/_buildManifest.js" defer=""></script><script src="/_next/static/efznPjd9fe3AImm5u1s3h/_ssgManifest.js" defer=""></script><script src="/_next/static/efznPjd9fe3AImm5u1s3h/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="container mx-auto px-5"><div style="position:fixed;background-color:rgba(255,255,255,0.9);backdrop-filter:blur(10px);width:100%;left:0px;z-index:1000"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8" style="padding:0;padding-left:10px;margin-bottom:20px"><a class="hover:underline" href="/">Learn</a>.</h2></div><article class="mb-32"><div style="height:100px"></div><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">docker</h1><div class="mb-8 md:mb-16 sm:mx-0"><div class="sm:mx-0"><img src="/assets/covers/docker.jpg" alt="Cover Image for docker" class="shadow-sm" layout="responsive" width="1240" height="620"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div>TODO: add language chip here</div></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__h_8de"><h1>Basic Commands</h1>
<ul>
<li>
<p>Basic commands</p>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment"># List all the images you have locally</span>
$ <span class="token function">docker</span> images

<span class="token comment"># List all the running containers</span>
$ <span class="token function">docker</span> <span class="token function">ps</span>

<span class="token comment"># List all available containers</span>
$ <span class="token function">docker</span> <span class="token function">ps</span> -a
</code></pre></div>
</li>
<li>
<p>Images</p>
<ul>
<li>Images are the blueprint to create a container
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> rmi <span class="token operator">&#x3C;</span>IMAGE_NAME<span class="token operator">></span>
$ <span class="token function">docker</span> build -t <span class="token operator">&#x3C;</span>IMAGE_NAME<span class="token operator">></span> -f Dockerfile <span class="token builtin class-name">.</span>
$ <span class="token function">docker</span> run <span class="token operator">&#x3C;</span>IMAGE_NAME<span class="token operator">></span> -n <span class="token operator">&#x3C;</span>CONTAINER_NAME<span class="token operator">></span> -p <span class="token number">8080</span>:8080
</code></pre></div>
</li>
<li><em>PORTS</em>. <Port exposed> : <Port running inside container></li>
</ul>
</li>
<li>
<p>Containers</p>
<ul>
<li>A container is a runnable instance of an image.</li>
<li>You can have multiple containers that were built from the same image</li>
<li>You can stop/start a container whenever
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> start <span class="token operator">&#x3C;</span>CONTAINER_NAME<span class="token operator">></span>
$ <span class="token function">docker</span> stop <span class="token operator">&#x3C;</span>CONTAINER_NAME<span class="token operator">></span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Creating an image</p>
<ul>
<li>
<p>All Docker images are based off some other image</p>
</li>
<li>
<p>Creating a basic nodejs applications create a <code>Dockerfile</code>:</p>
<ol>
<li>Create a simple nodejs express application:</li>
</ol>
<ul>
<li>Add some dependencies
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> init -y
$ <span class="token function">npm</span> i -D @babel/node@7 @babel/preset-env@7 @babel/cli@7 @babel/core@7
$ <span class="token function">npm</span> i express
$ <span class="token function">mkdir</span> src
$ <span class="token function">touch</span> src/index.js
</code></pre></div>
</li>
<li>Create a <code>.babelrc</code>
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"esmodules"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>Add some script to your <code>package.json</code> file
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon --exec babel-node src/index.js"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"babel src --out-dir dist"</span><span class="token punctuation">,</span>
    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"node dist/index.js"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>Create <code>src/index.js</code> file
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">express</span> <span class="token keyword module">from</span> <span class="token string">"express"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">Hello</span><span class="token operator">:</span> <span class="token string">"Express"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">"all other routes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ENV_VAR</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">ENV_VAR</span> <span class="token operator">||</span> <span class="token string">"none passes in"</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...REST API is running, some ENV variable (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">ENV_VAR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
</li>
</ul>
<ol start="2">
<li>Create <code>Dockerfile</code> file</li>
</ol>
<div class="remark-highlight"><pre class="language-Dockerfile"><code class="language-Dockerfile">FROM node:14

# Create app directory
WORKDIR /usr/src/app

# Install app dependencies
# A wildcard is used to ensure both package.json AND package-lock.json are copied
COPY package*.json ./
COPY src/ ./src

RUN npm install
RUN npm run build

EXPOSE 3000
CMD [ &#x26;quot;npm&#x26;quot;, &#x26;quot;run&#x26;quot;, &#x26;quot;serve&#x26;quot; ]</code></pre></div>
<ol start="3">
<li>Create image &#x26; run the container</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> build -t pdotwdot/hello-simple-express:latest <span class="token builtin class-name">.</span>
$ <span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> pdotwdot/hello-simple-express
$ <span class="token function">docker</span> run --name qqqqq -e <span class="token assign-left variable">ENV_VAR</span><span class="token operator">=</span><span class="token string">'some env!'</span> --rm  -p <span class="token number">1234</span>:3000 -t pdotwdot/hello-simple-express:latest
</code></pre></div>
<ol start="4">
<li>You can connect to that running container</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it <span class="token operator">&#x3C;</span>CONTAINER_NAME<span class="token operator">></span> <span class="token function">bash</span> 
$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it qqqqq <span class="token function">bash</span> 
</code></pre></div>
</li>
</ul>
</li>
</ul>
<h1>Docker Compose for development</h1>
<ul>
<li>Update the <code>package.json</code> file
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"prestart"</span><span class="token operator">:</span> <span class="token string">"npm i"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon --exec babel-node src/index.js"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"babel src --out-dir dist"</span><span class="token punctuation">,</span>
    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"node dist/index.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@babel/cli"</span><span class="token operator">:</span> <span class="token string">"^7.14.8"</span><span class="token punctuation">,</span>
    <span class="token property">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.15.0"</span><span class="token punctuation">,</span>
    <span class="token property">"@babel/node"</span><span class="token operator">:</span> <span class="token string">"^7.14.9"</span><span class="token punctuation">,</span>
    <span class="token property">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.15.0"</span><span class="token punctuation">,</span>
    <span class="token property">"nodemon"</span><span class="token operator">:</span> <span class="token string">"^2.0.12"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>Add a <code>.dockerignore</code> file with this:
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">node_modules
npm-debug.log</code></pre></div>
</li>
<li>Update the <code>Dockerfile</code>
<ul>
<li>Basically a shell of because we are going to add in the <code>src</code> as a volume
<div class="remark-highlight"><pre class="language-Dockerfile"><code class="language-Dockerfile">FROM node:14
WORKDIR /usr/local/app/

EXPOSE 3000
CMD [ &#x26;quot;npm&#x26;quot;, &#x26;quot;run&#x26;quot;, &#x26;quot;serve&#x26;quot; ]</code></pre></div>
</li>
</ul>
</li>
<li>Create a <code>docker-compose.yml</code> file
<div class="remark-highlight"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">node</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">command</span><span class="token punctuation">:</span> npm start
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3000:8080"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./src/<span class="token punctuation">:</span>/usr/local/app/src/
      <span class="token punctuation">-</span> ./.babelrc<span class="token punctuation">:</span>/usr/local/app/.babelrc
      <span class="token punctuation">-</span> ./package.json<span class="token punctuation">:</span>/usr/local/app/package.json
      <span class="token punctuation">-</span> ./package<span class="token punctuation">-</span>lock.json<span class="token punctuation">:</span>/usr/local/app/package<span class="token punctuation">-</span>lock.json
</code></pre></div>
</li>
<li>Run a command to get it running &#x26; visit the site at <code>http://localhost:3000/</code>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker-compose</span> up
$ <span class="token function">docker-compose</span> -f docker-compose.yml up  -d 
</code></pre></div>
</li>
<li>Cleanup
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker-compose</span> down --rmi all
</code></pre></div>
</li>
</ul>
<h1>Good Practices with</h1>
<ul>
<li>Use .dockerignore to prevent leaking secrets
<ul>
<li>Include a .dockerignore file that filters out common secret files and development artifacts.</li>
<li>By doing so, you might prevent secrets from leaking into the image.</li>
<li>As a bonus the build time will significantly decrease.</li>
<li>Also, ensure not to copy all files recursively rather explicitly choose what should be copied to Docker</li>
<li>Dependencies install first, then code</li>
</ul>
</li>
<li>Install "system" packages first</li>
<li>Use explicit image reference, avoid latest tag</li>
<li>Prefer smaller Docker base images</li>
<li>Scan images for multi-layers of vulnerabilities</li>
</ul>
<div class="remark-highlight"><pre class="language-docker"><code class="language-docker">sudo apt-get install rpm
 $ wget https://github.com/aquasecurity/trivy/releases/download/{TRIVY_VERSION}/trivy_{TRIVY_VERSION}_Linux-64bit.deb
 $ sudo dpkg -i trivy_{TRIVY_VERSION}_Linux-64bit.deb
 trivy image [YOUR_IMAGE_NAME]
</code></pre></div>
<h1>Stop and remove all docker containers and images</h1>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment">#List all containers (only IDs)</span>
$ <span class="token function">docker</span> <span class="token function">ps</span> -aq

<span class="token comment"># Stop all running containers</span>
$ <span class="token function">docker</span> stop <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -aq<span class="token variable">)</span></span>

<span class="token comment">#Remove all containers</span>
$ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -aq<span class="token variable">)</span></span>

<span class="token comment">#Remove all images</span>
$ <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images -q<span class="token variable">)</span></span>
</code></pre></div>
<h1>Run a docker image and pass in environment variables</h1>
<ul>
<li>do this with the "-e" flag</li>
<li>example:
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">$ docker run --rm --name test -e PORT=6666  my-image</code></pre></div>
</li>
</ul>
<h1>Cleanup</h1>
<ul>
<li>If you’ve ever ran a docker image ls you’ve likely noticed 1 or more items that have a <none> repository and a <none> tag.</li>
<li>Dangling images are not referenced by other images and are safe to delete.
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">$ docker rmi -f $(docker images -f &#x26;quot;dangling=true&#x26;quot; -q)</code></pre></div>
</li>
<li>newer versions of Docker (1.13+) there’s an even better command called <code>$ docker system prune</code> which will not only remove dangling images but it will also remove all stopped containers, all networks not used by at least 1 container, all dangling images and build caches.</li>
</ul>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">$ docker volume prune</code></pre></div>
<h1>Tags</h1>
<ul>
<li>Tagging your image during the build with the <code>-t</code> flag
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token comment"># docker build -t &#x3C;USERNAME>/&#x3C;IMAGE_NAME>:&#x3C;TAG_NAME> .</span>
$ <span class="token function">docker</span> build -t philopian/simple-node-server:0.0.1 <span class="token builtin class-name">.</span>
</code></pre></div>
</li>
<li>You can tag an image after the fact with
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token comment"># docker tag &#x3C;IMAGE_ID> &#x3C;TAG_NAME></span>
$ <span class="token function">docker</span> tag def13b34dc63 jupyter-web-ui-base
</code></pre></div>
</li>
</ul>
<h1>Docker Hub</h1>
<ul>
<li><a href="https://hub.docker.com/search?q=">Docker hub</a></li>
<li><img src="/assets/blog/docker/dockerhub-nodejs.jpg" alt="dockerhub"></li>
<li>If you take a look at the <code>supported tags</code> these are all the tags you can base your docker file off of. Most of the time people use the <code>node:latest</code> however you can pin it down to a specific version like <code>node:18</code> or <code>node:18-alpine3.15</code></li>
</ul>
<h2>Publishing a Docker image to DockerHub</h2>
<h1>Publishing a Docker image to DockerHub</h1>
<ol>
<li>Initialize:</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment"># git</span>
$ <span class="token function">git</span> init
$ <span class="token builtin class-name">echo</span> -e <span class="token string">"node_modules<span title="\n" class="token entity">\n</span>.env"</span> <span class="token operator">></span> .gitignore

<span class="token comment"># node</span>
$ <span class="token function">yarn</span> init -y
$ <span class="token function">yarn</span> <span class="token function">add</span> express
$ <span class="token function">yarn</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span>jq <span class="token string">'.scripts.start="node src/index.js"'</span> package.json<span class="token variable">`</span></span>"</span> <span class="token operator">></span> package.json
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span>jq <span class="token string">'.scripts.dev="PORT=1234 node src/index.js"'</span> package.json<span class="token variable">`</span></span>"</span> <span class="token operator">></span> package.json
<span class="token comment"># docker</span>
$ <span class="token builtin class-name">echo</span> -e <span class="token string">"node_modules<span title="\n" class="token entity">\n</span>npm-debug.log"</span> <span class="token operator">></span> .dockerignore
</code></pre></div>
<ol start="2">
<li>Create a simple server <code>./src/index.js</code></li>
</ol>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Constants</span>
<span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">HOST</span> <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span><span class="token punctuation">;</span>

<span class="token comment">// App</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">"Hello DockerHub"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token constant">HOST</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running on http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<ol start="3">
<li>Create a <code>./Dockerfile</code></li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">FROM node:18

<span class="token comment"># Create app directory</span>
WORKDIR /usr/src/app

<span class="token comment"># Install app dependencies</span>
<span class="token comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span>
<span class="token comment"># where available (npm@5+)</span>
COPY package*.json ./

RUN <span class="token function">npm</span> <span class="token function">install</span>
<span class="token comment"># If you are building your code for production</span>
<span class="token comment"># RUN npm ci --only=production</span>

<span class="token comment"># Bundle app source</span>
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

EXPOSE <span class="token number">8080</span>
CMD <span class="token punctuation">[</span> <span class="token string">"npm"</span>, <span class="token string">"start"</span> <span class="token punctuation">]</span>
</code></pre></div>
<ol start="4">
<li>Create a <code>./.env</code> file for all the variables</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">DOCKER_APP_VERSION</span><span class="token operator">=</span><span class="token string">"0.0.1"</span>
<span class="token assign-left variable">DOCKER_NAMESPACE</span><span class="token operator">=</span><span class="token string">"pdotwdot"</span>
<span class="token assign-left variable">DOCKER_APP_NAME</span><span class="token operator">=</span><span class="token string">"simple-express"</span>
</code></pre></div>
<ol start="5">
<li>Create a local docker image</li>
</ol>
<ul>
<li>Basic Docker commands:
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment"># list all the local containers</span>
$ <span class="token function">docker</span> <span class="token function">ps</span> -a

<span class="token comment"># list all the local images</span>
$ <span class="token function">docker</span> images
</code></pre></div>
</li>
<li>Build the image locally
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">$ export $(grep -v &#x26;#39;^#&#x26;#39; .env | xargs)

# $ docker build -t &#x26;lt;DOCKER_NAMESPACE&#x26;gt;/&#x26;lt;DOCKER_APP_NAME&#x26;gt;:&#x26;lt;DOCKER_APP_VERSION&#x26;gt; &#x26;lt;FILEPATH&#x26;gt;
$ DOCKER_IMAGE_NAME=&#x26;quot;$DOCKER_NAMESPACE/$DOCKER_APP_NAME:$DOCKER_APP_VERSION&#x26;quot;
$ docker build -t $DOCKER_IMAGE_NAME .</code></pre></div>
</li>
</ul>
<ol start="6">
<li>Run the docker container locally</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell"><span class="token comment"># docker run -d -p &#x3C;Host port>:&#x3C;Docker port> &#x3C;docker-image-name></span>
$ <span class="token function">docker</span> run -d -p <span class="token number">9090</span>:8080 <span class="token variable">$DOCKER_IMAGE_NAME</span>
</code></pre></div>
<ol start="7">
<li>Deploy to DockerHub</li>
</ol>
<div class="remark-highlight"><pre class="language-shell"><code class="language-shell">$ <span class="token function">docker</span> login --username pdotwdot 
$ <span class="token function">docker</span> push <span class="token variable">$DOCKER_IMAGE_NAME</span>
</code></pre></div>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="/">Learn something else</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"docker","slug":"docker","content":"\u003ch1\u003eBasic Commands\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eBasic commands\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e# List all the images you have locally\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e images\n\n\u003cspan class=\"token comment\"\u003e# List all the running containers\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# List all available containers\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e -a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eImages\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImages are the blueprint to create a container\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e rmi \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eIMAGE_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e build -t \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eIMAGE_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e -f Dockerfile \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e run \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eIMAGE_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e -n \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCONTAINER_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e -p \u003cspan class=\"token number\"\u003e8080\u003c/span\u003e:8080\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cem\u003ePORTS\u003c/em\u003e. \u003cPort exposed\u003e : \u003cPort running inside container\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eContainers\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA container is a runnable instance of an image.\u003c/li\u003e\n\u003cli\u003eYou can have multiple containers that were built from the same image\u003c/li\u003e\n\u003cli\u003eYou can stop/start a container whenever\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e start \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCONTAINER_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e stop \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCONTAINER_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreating an image\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAll Docker images are based off some other image\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreating a basic nodejs applications create a \u003ccode\u003eDockerfile\u003c/code\u003e:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCreate a simple nodejs express application:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eAdd some dependencies\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e init -y\n$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e i -D @babel/node@7 @babel/preset-env@7 @babel/cli@7 @babel/core@7\n$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e i express\n$ \u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e src\n$ \u003cspan class=\"token function\"\u003etouch\u003c/span\u003e src/index.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a \u003ccode\u003e.babelrc\u003c/code\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"presets\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"@babel/preset-env\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token property\"\u003e\"targets\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token property\"\u003e\"esmodules\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eAdd some script to your \u003ccode\u003epackage.json\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nodemon --exec babel-node src/index.js\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"babel src --out-dir dist\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"serve\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"node dist/index.js\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate \u003ccode\u003esrc/index.js\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003eexpress\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"express\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e app \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eexpress\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token literal-property property\"\u003eHello\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Express\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"all other routes\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e8080\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eENV_VAR\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eENV_VAR\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"none passes in\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elisten\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e...REST API is running, some ENV variable (\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token constant\"\u003eENV_VAR\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eCreate \u003ccode\u003eDockerfile\u003c/code\u003e file\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-Dockerfile\"\u003e\u003ccode class=\"language-Dockerfile\"\u003eFROM node:14\n\n# Create app directory\nWORKDIR /usr/src/app\n\n# Install app dependencies\n# A wildcard is used to ensure both package.json AND package-lock.json are copied\nCOPY package*.json ./\nCOPY src/ ./src\n\nRUN npm install\nRUN npm run build\n\nEXPOSE 3000\nCMD [ \u0026#x26;quot;npm\u0026#x26;quot;, \u0026#x26;quot;run\u0026#x26;quot;, \u0026#x26;quot;serve\u0026#x26;quot; ]\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eCreate image \u0026#x26; run the container\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e build -t pdotwdot/hello-simple-express:latest \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e images \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token function\"\u003egrep\u003c/span\u003e pdotwdot/hello-simple-express\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e run --name qqqqq -e \u003cspan class=\"token assign-left variable\"\u003eENV_VAR\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'some env!'\u003c/span\u003e --rm  -p \u003cspan class=\"token number\"\u003e1234\u003c/span\u003e:3000 -t pdotwdot/hello-simple-express:latest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eYou can connect to that running container\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token builtin class-name\"\u003eexec\u003c/span\u003e -it \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCONTAINER_NAME\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003ebash\u003c/span\u003e \n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token builtin class-name\"\u003eexec\u003c/span\u003e -it qqqqq \u003cspan class=\"token function\"\u003ebash\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eDocker Compose for development\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eUpdate the \u003ccode\u003epackage.json\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"prestart\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"npm i\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nodemon --exec babel-node src/index.js\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"babel src --out-dir dist\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"serve\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"node dist/index.js\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@babel/cli\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^7.14.8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@babel/core\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^7.15.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@babel/node\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^7.14.9\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@babel/preset-env\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^7.15.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"nodemon\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^2.0.12\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"express\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"^4.17.1\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eAdd a \u003ccode\u003e.dockerignore\u003c/code\u003e file with this:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003enode_modules\nnpm-debug.log\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eUpdate the \u003ccode\u003eDockerfile\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eBasically a shell of because we are going to add in the \u003ccode\u003esrc\u003c/code\u003e as a volume\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-Dockerfile\"\u003e\u003ccode class=\"language-Dockerfile\"\u003eFROM node:14\nWORKDIR /usr/local/app/\n\nEXPOSE 3000\nCMD [ \u0026#x26;quot;npm\u0026#x26;quot;, \u0026#x26;quot;run\u0026#x26;quot;, \u0026#x26;quot;serve\u0026#x26;quot; ]\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a \u003ccode\u003edocker-compose.yml\u003c/code\u003e file\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yml\"\u003e\u003ccode class=\"language-yml\"\u003e\u003cspan class=\"token key atrule\"\u003eversion\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'3'\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003eservices\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003enode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003ebuild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e .\n    \u003cspan class=\"token key atrule\"\u003ecommand\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e npm start\n    \u003cspan class=\"token key atrule\"\u003eports\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"3000:8080\"\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003evolumes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e ./src/\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e/usr/local/app/src/\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e ./.babelrc\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e/usr/local/app/.babelrc\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e ./package.json\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e/usr/local/app/package.json\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e ./package\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003elock.json\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e/usr/local/app/package\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003elock.json\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eRun a command to get it running \u0026#x26; visit the site at \u003ccode\u003ehttp://localhost:3000/\u003c/code\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker-compose\u003c/span\u003e up\n$ \u003cspan class=\"token function\"\u003edocker-compose\u003c/span\u003e -f docker-compose.yml up  -d \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eCleanup\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker-compose\u003c/span\u003e down --rmi all\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eGood Practices with\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eUse .dockerignore to prevent leaking secrets\n\u003cul\u003e\n\u003cli\u003eInclude a .dockerignore file that filters out common secret files and development artifacts.\u003c/li\u003e\n\u003cli\u003eBy doing so, you might prevent secrets from leaking into the image.\u003c/li\u003e\n\u003cli\u003eAs a bonus the build time will significantly decrease.\u003c/li\u003e\n\u003cli\u003eAlso, ensure not to copy all files recursively rather explicitly choose what should be copied to Docker\u003c/li\u003e\n\u003cli\u003eDependencies install first, then code\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInstall \"system\" packages first\u003c/li\u003e\n\u003cli\u003eUse explicit image reference, avoid latest tag\u003c/li\u003e\n\u003cli\u003ePrefer smaller Docker base images\u003c/li\u003e\n\u003cli\u003eScan images for multi-layers of vulnerabilities\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-docker\"\u003e\u003ccode class=\"language-docker\"\u003esudo apt-get install rpm\n $ wget https://github.com/aquasecurity/trivy/releases/download/{TRIVY_VERSION}/trivy_{TRIVY_VERSION}_Linux-64bit.deb\n $ sudo dpkg -i trivy_{TRIVY_VERSION}_Linux-64bit.deb\n trivy image [YOUR_IMAGE_NAME]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1\u003eStop and remove all docker containers and images\u003c/h1\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e#List all containers (only IDs)\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e -aq\n\n\u003cspan class=\"token comment\"\u003e# Stop all running containers\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e stop \u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e$(\u003c/span\u003e\u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e -aq\u003cspan class=\"token variable\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e#Remove all containers\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003erm\u003c/span\u003e \u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e$(\u003c/span\u003e\u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e -aq\u003cspan class=\"token variable\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e#Remove all images\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e rmi \u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e$(\u003c/span\u003e\u003cspan class=\"token function\"\u003edocker\u003c/span\u003e images -q\u003cspan class=\"token variable\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1\u003eRun a docker image and pass in environment variables\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003edo this with the \"-e\" flag\u003c/li\u003e\n\u003cli\u003eexample:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ docker run --rm --name test -e PORT=6666  my-image\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eCleanup\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eIf you’ve ever ran a docker image ls you’ve likely noticed 1 or more items that have a \u003cnone\u003e repository and a \u003cnone\u003e tag.\u003c/li\u003e\n\u003cli\u003eDangling images are not referenced by other images and are safe to delete.\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ docker rmi -f $(docker images -f \u0026#x26;quot;dangling=true\u0026#x26;quot; -q)\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003enewer versions of Docker (1.13+) there’s an even better command called \u003ccode\u003e$ docker system prune\u003c/code\u003e which will not only remove dangling images but it will also remove all stopped containers, all networks not used by at least 1 container, all dangling images and build caches.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ docker volume prune\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1\u003eTags\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eTagging your image during the build with the \u003ccode\u003e-t\u003c/code\u003e flag\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# docker build -t \u0026#x3C;USERNAME\u003e/\u0026#x3C;IMAGE_NAME\u003e:\u0026#x3C;TAG_NAME\u003e .\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e build -t philopian/simple-node-server:0.0.1 \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eYou can tag an image after the fact with\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# docker tag \u0026#x3C;IMAGE_ID\u003e \u0026#x3C;TAG_NAME\u003e\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e tag def13b34dc63 jupyter-web-ui-base\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eDocker Hub\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://hub.docker.com/search?q=\"\u003eDocker hub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"/assets/blog/docker/dockerhub-nodejs.jpg\" alt=\"dockerhub\"\u003e\u003c/li\u003e\n\u003cli\u003eIf you take a look at the \u003ccode\u003esupported tags\u003c/code\u003e these are all the tags you can base your docker file off of. Most of the time people use the \u003ccode\u003enode:latest\u003c/code\u003e however you can pin it down to a specific version like \u003ccode\u003enode:18\u003c/code\u003e or \u003ccode\u003enode:18-alpine3.15\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003ePublishing a Docker image to DockerHub\u003c/h2\u003e\n\u003ch1\u003ePublishing a Docker image to DockerHub\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003eInitialize:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e# git\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003egit\u003c/span\u003e init\n$ \u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"token string\"\u003e\"node_modules\u003cspan title=\"\\n\" class=\"token entity\"\u003e\\n\u003c/span\u003e.env\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e .gitignore\n\n\u003cspan class=\"token comment\"\u003e# node\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003eyarn\u003c/span\u003e init -y\n$ \u003cspan class=\"token function\"\u003eyarn\u003c/span\u003e \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e express\n$ \u003cspan class=\"token function\"\u003eyarn\u003c/span\u003e\n$ \u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e`\u003c/span\u003ejq \u003cspan class=\"token string\"\u003e'.scripts.start=\"node src/index.js\"'\u003c/span\u003e package.json\u003cspan class=\"token variable\"\u003e`\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e package.json\n$ \u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003cspan class=\"token variable\"\u003e\u003cspan class=\"token variable\"\u003e`\u003c/span\u003ejq \u003cspan class=\"token string\"\u003e'.scripts.dev=\"PORT=1234 node src/index.js\"'\u003c/span\u003e package.json\u003cspan class=\"token variable\"\u003e`\u003c/span\u003e\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e package.json\n\u003cspan class=\"token comment\"\u003e# docker\u003c/span\u003e\n$ \u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"token string\"\u003e\"node_modules\u003cspan title=\"\\n\" class=\"token entity\"\u003e\\n\u003c/span\u003enpm-debug.log\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e .dockerignore\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eCreate a simple server \u003ccode\u003e./src/index.js\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e express \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"express\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Constants\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e8080\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eHOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// App\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e app \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eexpress\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Hello DockerHub\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elisten\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eHOST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eRunning on http://\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token constant\"\u003eHOST\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e:\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eCreate a \u003ccode\u003e./Dockerfile\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003eFROM node:18\n\n\u003cspan class=\"token comment\"\u003e# Create app directory\u003c/span\u003e\nWORKDIR /usr/src/app\n\n\u003cspan class=\"token comment\"\u003e# Install app dependencies\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# A wildcard is used to ensure both package.json AND package-lock.json are copied\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# where available (npm@5+)\u003c/span\u003e\nCOPY package*.json ./\n\nRUN \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# If you are building your code for production\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# RUN npm ci --only=production\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Bundle app source\u003c/span\u003e\nCOPY \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n\nEXPOSE \u003cspan class=\"token number\"\u003e8080\u003c/span\u003e\nCMD \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"npm\"\u003c/span\u003e, \u003cspan class=\"token string\"\u003e\"start\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eCreate a \u003ccode\u003e./.env\u003c/code\u003e file for all the variables\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token assign-left variable\"\u003eDOCKER_APP_VERSION\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"0.0.1\"\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eDOCKER_NAMESPACE\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"pdotwdot\"\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eDOCKER_APP_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"simple-express\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eCreate a local docker image\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eBasic Docker commands:\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e# list all the local containers\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e \u003cspan class=\"token function\"\u003eps\u003c/span\u003e -a\n\n\u003cspan class=\"token comment\"\u003e# list all the local images\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e images\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003eBuild the image locally\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ export $(grep -v \u0026#x26;#39;^#\u0026#x26;#39; .env | xargs)\n\n# $ docker build -t \u0026#x26;lt;DOCKER_NAMESPACE\u0026#x26;gt;/\u0026#x26;lt;DOCKER_APP_NAME\u0026#x26;gt;:\u0026#x26;lt;DOCKER_APP_VERSION\u0026#x26;gt; \u0026#x26;lt;FILEPATH\u0026#x26;gt;\n$ DOCKER_IMAGE_NAME=\u0026#x26;quot;$DOCKER_NAMESPACE/$DOCKER_APP_NAME:$DOCKER_APP_VERSION\u0026#x26;quot;\n$ docker build -t $DOCKER_IMAGE_NAME .\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eRun the docker container locally\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e\u003cspan class=\"token comment\"\u003e# docker run -d -p \u0026#x3C;Host port\u003e:\u0026#x3C;Docker port\u003e \u0026#x3C;docker-image-name\u003e\u003c/span\u003e\n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e run -d -p \u003cspan class=\"token number\"\u003e9090\u003c/span\u003e:8080 \u003cspan class=\"token variable\"\u003e$DOCKER_IMAGE_NAME\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"7\"\u003e\n\u003cli\u003eDeploy to DockerHub\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell\"\u003e\u003ccode class=\"language-shell\"\u003e$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e login --username pdotwdot \n$ \u003cspan class=\"token function\"\u003edocker\u003c/span\u003e push \u003cspan class=\"token variable\"\u003e$DOCKER_IMAGE_NAME\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n","ogImage":{"url":"/assets/covers/docker.jpg"},"coverImage":"/assets/covers/docker.jpg"}},"__N_SSG":true},"page":"/learn/[slug]","query":{"slug":"docker"},"buildId":"efznPjd9fe3AImm5u1s3h","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>